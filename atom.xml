<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>阿珂的个人博客</title>
  
  
  <link href="https://www.980101.top/atom.xml" rel="self"/>
  
  <link href="https://www.980101.top/"/>
  <updated>2025-06-19T16:06:59.756Z</updated>
  <id>https://www.980101.top/</id>
  
  <author>
    <name>阿珂</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>图片本地化</title>
    <link href="https://www.980101.top/2025/06/10/%E5%9B%BE%E7%89%87%E6%9C%AC%E5%9C%B0%E5%8C%96/"/>
    <id>https://www.980101.top/2025/06/10/%E5%9B%BE%E7%89%87%E6%9C%AC%E5%9C%B0%E5%8C%96/</id>
    <published>2025-06-10T02:11:00.000Z</published>
    <updated>2025-06-19T16:06:59.756Z</updated>
    
    <content type="html"><![CDATA[<h1 id="记一次php解析html"><a href="#记一次php解析html" class="headerlink" title="记一次php解析html"></a>记一次php解析html</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 防止html被转义</span></span><br><span class="line"><span class="variable">$html</span> = <span class="title function_ invoke__">mb_convert_encoding</span>(<span class="variable">$html</span>, <span class="string">&#x27;HTML-ENTITIES&#x27;</span>, <span class="string">&#x27;UTF-8&#x27;</span>);</span><br><span class="line"><span class="comment"># 加载html</span></span><br><span class="line"><span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">\DOMDocument</span>(<span class="string">&#x27;1.0&#x27;</span>, <span class="string">&#x27;UTF-8&#x27;</span>);</span><br><span class="line">@<span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadHTML</span>(<span class="variable">$html</span>);</span><br><span class="line"><span class="comment"># 读取所有img标签</span></span><br><span class="line"><span class="variable">$images</span> = <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">getElementsByTagName</span>(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line"><span class="comment"># 通过类获取指定html所有节点 nodes 是数组</span></span><br><span class="line"><span class="variable">$finder</span> = <span class="keyword">new</span> <span class="title class_">\DOMXPath</span>(<span class="variable">$dom</span>);</span><br><span class="line"><span class="variable">$nodes</span> = <span class="variable">$finder</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;//*[contains(concat(&#x27; &#x27;, normalize-space(@class), &#x27; &#x27;), &#x27; <span class="subst">$class</span> &#x27;)]&quot;</span>);</span><br><span class="line"><span class="comment"># 通过id获取html节点</span></span><br><span class="line"><span class="variable">$element</span> = <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">getElementById</span>(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 内容保存 ####</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只取body内容，防止内容丢失</span></span><br><span class="line"><span class="variable">$body</span> = <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">getElementsByTagName</span>(<span class="string">&#x27;body&#x27;</span>)-&gt;<span class="title function_ invoke__">item</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment"># 保存html</span></span><br><span class="line"><span class="variable">$newHtml</span> = <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">saveHTML</span>(<span class="variable">$body</span>);</span><br><span class="line"><span class="comment"># 去除&lt;body&gt;标签</span></span><br><span class="line"><span class="variable">$newHtml</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/^&lt;body[^&gt;]*&gt;|&lt;\/body&gt;$/i&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$newHtml</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反转义所有HTML实体 针对第一步</span></span><br><span class="line"><span class="variable">$newHtml</span> = <span class="title function_ invoke__">html_entity_decode</span>(<span class="variable">$newHtml</span>, ENT_QUOTES | ENT_HTML5, <span class="string">&#x27;UTF-8&#x27;</span>);</span><br></pre></td></tr></table></figure><h1 id="图片本地化"><a href="#图片本地化" class="headerlink" title="图片本地化"></a>图片本地化</h1><blockquote><p>基于laravel</p><p>主要用到了laravel中的Http类</p><p>use Illuminate\Support\Facades\DB;</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Http</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$images</span> <span class="keyword">as</span> <span class="variable">$img</span>) &#123;</span><br><span class="line">   <span class="variable">$src</span> = <span class="variable">$img</span>-&gt;<span class="title function_ invoke__">getAttribute</span>(<span class="string">&#x27;src&#x27;</span>);</span><br><span class="line">   <span class="comment"># 如果包含本地路径，则跳过</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="title function_ invoke__">str_contains</span>(<span class="variable">$src</span>, <span class="variable">$domain</span>) !== <span class="literal">false</span>) <span class="keyword">continue</span>;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (!<span class="title function_ invoke__">str_contains</span>(<span class="variable">$hostname</span>, <span class="variable">$strMain</span>)) &#123;</span><br><span class="line">            <span class="variable">$response</span> = <span class="title class_">Http</span>::<span class="title function_ invoke__">withoutVerifying</span>()-&gt;<span class="title function_ invoke__">head</span>(<span class="variable">$src</span>);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$response</span> = <span class="title class_">Http</span>::<span class="title function_ invoke__">head</span>(<span class="variable">$src</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (!<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">ok</span>()) &#123;</span><br><span class="line">            <span class="variable">$statusCode</span> = <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">status</span>();</span><br><span class="line">            <span class="variable">$errorMessage</span> = <span class="string">&quot;远程图片资源不存在 (状态码: <span class="subst">$statusCode</span>)&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$statusCodeMap</span>[<span class="variable">$statusCode</span>])) &#123;</span><br><span class="line">                <span class="variable">$errorMessage</span> .= <span class="string">&quot; - &quot;</span> . <span class="variable">$statusCodeMap</span>[<span class="variable">$statusCode</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\Exception</span>(<span class="variable">$errorMessage</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="variable">$parsed</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$src</span>);</span><br><span class="line">       <span class="variable">$path</span> = <span class="variable">$parsed</span>[<span class="string">&#x27;path&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">       <span class="variable">$filename</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$path</span>);</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\Exception</span>(<span class="string">&#x27;获取图片名错误&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 下载图片</span></span><br><span class="line">        <span class="variable">$imageData</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$src</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$imageData</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\Exception</span>(<span class="string">&#x27;下载失败&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// [新增] 内容验证（核心校验逻辑）</span></span><br><span class="line">        <span class="variable">$isValidImage</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// 方法2：使用finfo更严格检测（双重验证）</span></span><br><span class="line">        <span class="variable">$finfo</span> = <span class="keyword">new</span> \<span class="title function_ invoke__">finfo</span>(FILEINFO_MIME_TYPE);</span><br><span class="line">        <span class="variable">$detectedMime</span> = <span class="variable">$finfo</span>-&gt;<span class="title function_ invoke__">buffer</span>(<span class="variable">$imageData</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">str_starts_with</span>(<span class="variable">$detectedMime</span>, <span class="string">&#x27;image/&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$isValidImage</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// [新增] 扩展名与MIME类型匹配校验</span></span><br><span class="line">        <span class="variable">$parsed</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$src</span>);</span><br><span class="line">        <span class="variable">$path</span> = <span class="variable">$parsed</span>[<span class="string">&#x27;path&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$allowedTypes</span> = [</span><br><span class="line">            <span class="string">&#x27;jpg&#x27;</span>  =&gt; <span class="string">&#x27;image/jpeg&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;jpeg&#x27;</span> =&gt; <span class="string">&#x27;image/jpeg&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;png&#x27;</span>  =&gt; <span class="string">&#x27;image/png&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;gif&#x27;</span>  =&gt; <span class="string">&#x27;image/gif&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;webp&#x27;</span> =&gt; <span class="string">&#x27;image/webp&#x27;</span></span><br><span class="line">         ];</span><br><span class="line">         <span class="comment"># 判断 MIME 类型在不在数组中</span></span><br><span class="line">         <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$detectedMime</span>, <span class="variable">$allowedTypes</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\Exception</span>(<span class="string">&quot;非图片类型&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment"># 获取真实后缀</span></span><br><span class="line">         <span class="variable">$ext</span> = <span class="title function_ invoke__">array_search</span>(<span class="variable">$detectedMime</span>, <span class="variable">$allowedTypes</span>);</span><br><span class="line">         <span class="comment"># 这种写法会导致当文件是其他图片格式，但是改了后缀就无法通过的问题</span></span><br><span class="line">         <span class="variable">$originalExt</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$path</span>, PATHINFO_EXTENSION));</span><br><span class="line">         <span class="comment"># 如果后缀和MIME类型一致，则使用原来的后缀（不是就使用源后缀）</span></span><br><span class="line">         <span class="keyword">if</span> (<span class="variable">$allowedTypes</span>[<span class="variable">$originalExt</span>] == <span class="variable">$detectedMime</span>) &#123;</span><br><span class="line">            <span class="variable">$ext</span> = <span class="variable">$originalExt</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$originalExt</span>, <span class="title function_ invoke__">array_keys</span>(<span class="variable">$allowedTypes</span>))) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\Exception</span>(<span class="string">&quot;非图片类型&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span> (!<span class="variable">$isValidImage</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\Exception</span>(<span class="string">&#x27;文件不是图片&#x27;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="variable">$filename</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">uniqid</span>()) . <span class="string">&quot;.&quot;</span> . <span class="variable">$ext</span>;</span><br><span class="line">         <span class="comment">// 保存文件</span></span><br><span class="line">         <span class="variable">$localPath</span> = <span class="variable">$fullDir</span> . <span class="variable">$filename</span>;</span><br><span class="line">         <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$localPath</span>, <span class="variable">$imageData</span>);</span><br><span class="line">         <span class="keyword">if</span> (<span class="title function_ invoke__">isProduction</span>()) &#123;</span><br><span class="line">            <span class="comment">// 构建web访问路径</span></span><br><span class="line">            <span class="variable">$webPath</span> = <span class="string">&quot;https://&quot;</span> . <span class="variable">$domain</span> . <span class="variable">$saveDir</span> . <span class="variable">$filename</span>;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$webPath</span> = <span class="string">&quot;http://&quot;</span> . <span class="variable">$domain</span> . <span class="variable">$saveDir</span> . <span class="variable">$filename</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="variable">$img</span>-&gt;<span class="title function_ invoke__">setAttribute</span>(<span class="string">&#x27;src&#x27;</span>, <span class="variable">$webPath</span>);</span><br><span class="line">         <span class="variable">$results</span>[<span class="string">&#x27;success&#x27;</span>][] = [</span><br><span class="line">            <span class="string">&quot;remote&quot;</span> =&gt; <span class="variable">$src</span>,</span><br><span class="line">            <span class="string">&quot;local&quot;</span> =&gt; <span class="variable">$webPath</span>,</span><br><span class="line">         ];</span><br><span class="line">         <span class="variable">$insert</span>[] = [</span><br><span class="line">             <span class="string">&quot;url&quot;</span> =&gt; <span class="variable">$webPath</span>,</span><br><span class="line">             <span class="string">&quot;remote_url&quot;</span> =&gt; <span class="variable">$src</span>,</span><br><span class="line">             <span class="string">&quot;path&quot;</span> =&gt; <span class="variable">$saveDir</span> . <span class="variable">$filename</span>,</span><br><span class="line">             <span class="string">&quot;admin_id&quot;</span> =&gt; <span class="title function_ invoke__">auth</span>(<span class="string">&quot;plat&quot;</span>)-&gt;<span class="title function_ invoke__">user</span>()-&gt;id,</span><br><span class="line">             <span class="string">&quot;created_at&quot;</span> =&gt; <span class="variable">$time</span>,</span><br><span class="line">             <span class="string">&quot;updated_at&quot;</span> =&gt; <span class="variable">$time</span>,</span><br><span class="line">         ];</span><br><span class="line">     &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">         <span class="variable">$results</span>[<span class="string">&#x27;failed&#x27;</span>][] = [</span><br><span class="line">             <span class="string">&quot;message&quot;</span> =&gt; <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>(),</span><br><span class="line">             <span class="string">&quot;remote&quot;</span> =&gt; <span class="variable">$src</span></span><br><span class="line">         ];</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;记一次php解析html&quot;&gt;&lt;a href=&quot;#记一次php解析html&quot; class=&quot;headerlink&quot; title=&quot;记一次php解析html&quot;&gt;&lt;/a&gt;记一次php解析html&lt;/h1&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;ta</summary>
      
    
    
    
    <category term="php" scheme="https://www.980101.top/categories/php/"/>
    
    
    <category term="php" scheme="https://www.980101.top/tags/php/"/>
    
    <category term="laravel" scheme="https://www.980101.top/tags/laravel/"/>
    
  </entry>
  
  <entry>
    <title>docker查看日志</title>
    <link href="https://www.980101.top/2024/05/10/docker%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97/"/>
    <id>https://www.980101.top/2024/05/10/docker%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97/</id>
    <published>2024-05-10T08:41:28.000Z</published>
    <updated>2025-04-19T15:06:16.518Z</updated>
    
    <content type="html"><![CDATA[<p>docker查看日志</p><span id="more"></span><h3 id="docker查看日志"><a href="#docker查看日志" class="headerlink" title="docker查看日志"></a>docker查看日志</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f -t --since=&quot;<span class="number">2024</span>-<span class="number">05</span>-<span class="number">06</span>&quot; --tail=<span class="number">100</span> CONTAINER_ID</span><br><span class="line">// since 查看指定时间之后的日志</span><br><span class="line">// tail 查看多少条</span><br><span class="line">// CONTAINER_ID 容器ID</span><br><span class="line"></span><br><span class="line">docker logs --since <span class="number">30</span>m CONTAINER_ID</span><br><span class="line">// 查看近<span class="number">30</span>分钟的日志</span><br></pre></td></tr></table></figure><table><thead><tr><th align="center">名称，简写</th><th align="center">默认</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center"><code>--details</code></td><td align="center"></td><td align="center">显示更多的信息</td></tr><tr><td align="center"><code>--follow</code> , <code>-f</code></td><td align="center"></td><td align="center">跟踪日志输出</td></tr><tr><td align="center"><code>--since</code></td><td align="center"></td><td align="center">显示自某个timestamp之后的日志，或相对时间，如42m（即42分钟）</td></tr><tr><td align="center"><code>--tail</code> , <code>-n</code></td><td align="center"><code>all</code></td><td align="center">从日志末尾显示的行数，默认为all</td></tr><tr><td align="center"><code>--timestamps</code> , <code>-t</code></td><td align="center"></td><td align="center">显示时间戳</td></tr><tr><td align="center"><code>--until</code></td><td align="center"></td><td align="center">显示自某个timestamp之前的日志，或相对时间，如42m（即42分钟）</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;p&gt;docker查看日志&lt;/p&gt;</summary>
    
    
    
    <category term="docker" scheme="https://www.980101.top/categories/docker/"/>
    
    
    <category term="docker" scheme="https://www.980101.top/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Linux常用命令</title>
    <link href="https://www.980101.top/2023/03/24/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>https://www.980101.top/2023/03/24/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</id>
    <published>2023-03-24T08:25:23.000Z</published>
    <updated>2025-06-19T16:27:11.496Z</updated>
    
    <content type="html"><![CDATA[<h4 id="nginx相关命令"><a href="#nginx相关命令" class="headerlink" title="nginx相关命令"></a>nginx相关命令</h4><h5 id="重启nginx"><a href="#重启nginx" class="headerlink" title="重启nginx"></a>重启nginx</h5><blockquote><p>service nginx restart</p></blockquote><h5 id="启动nginx-service-相关命令"><a href="#启动nginx-service-相关命令" class="headerlink" title="启动nginx(service 相关命令)"></a>启动nginx(service 相关命令)</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service nginx <span class="built_in">start</span> </span><br><span class="line"># 启动nginxservice nginx stop </span><br><span class="line"># 停止nginxservice nginx status </span><br><span class="line">#查看nginx状态</span><br></pre></td></tr></table></figure><h5 id="重载nginx配置文件"><a href="#重载nginx配置文件" class="headerlink" title="重载nginx配置文件"></a>重载nginx配置文件</h5><blockquote><p>nginx -s reload</p></blockquote><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><h5 id="改变文件所属用户"><a href="#改变文件所属用户" class="headerlink" title="改变文件所属用户"></a>改变文件所属用户</h5><blockquote><p>chown -R www-data:www-data test&#x2F; </p></blockquote><h5 id="删除用户组-用户-查看用户所属组"><a href="#删除用户组-用户-查看用户所属组" class="headerlink" title="删除用户组&#x2F;用户,查看用户所属组"></a>删除用户组&#x2F;用户,查看用户所属组</h5><blockquote><p>sudo groupdel name 删除用户组</p></blockquote><blockquote><p>sudo userdel name 删除用户</p></blockquote><blockquote><p>groups name 查看用户所属用户组</p></blockquote><h5 id="添加软连接"><a href="#添加软连接" class="headerlink" title="添加软连接"></a>添加软连接</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /etc/nginx/sites-available/hengyi /etc/nginx/sites-enabled/</span><br><span class="line">#ln -s 源文件/目录 目标链接文件/目录</span><br></pre></td></tr></table></figure><h5 id="zip相关命令首先安装zip"><a href="#zip相关命令首先安装zip" class="headerlink" title="zip相关命令首先安装zip"></a>zip相关命令<strong>首先安装zip</strong></h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install zip</span><br></pre></td></tr></table></figure><p><strong>压缩文件</strong></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -r test.zip ./*</span><br></pre></td></tr></table></figure><blockquote><p>把myfile.zip文件解压到 &#x2F;home&#x2F;sunny&#x2F;<br>-o:不提示的情况下覆盖文件;<br>-d:-d &#x2F;home&#x2F;sunny指明将文件解压缩到&#x2F;home&#x2F;sunny目录下。</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip -o -d /home/sunny test.zip</span><br></pre></td></tr></table></figure><p><strong>删除压缩包中的文件</strong></p><blockquote><p>删除压缩文件中test.txt文件</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -d myfile.zip test.txt</span><br></pre></td></tr></table></figure><blockquote><p>test.zip中添加rpm_info.txt文件。</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -m test.zip ./rpm_info.txt</span><br></pre></td></tr></table></figure><p><strong>同步系统时间(ntpdate)</strong></p><blockquote><p>查看系统时间</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl</span><br></pre></td></tr></table></figure><blockquote><p>下载 ntpdate</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install ntpdate</span><br></pre></td></tr></table></figure><blockquote><p>ntp常用服务器</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cn.pool.ntp.org 中国开源免费NTP服务器ntp1.aliyun.com 阿里云NTP服务器ntp2.aliyun.com 阿里云NTP服务器</span><br><span class="line">time1.aliyun.com 阿里云NTP服务器time2.aliyun.com 阿里云NTP服务器</span><br></pre></td></tr></table></figure><blockquote><p>同步时间</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntpdate ntp1.aliyun.com(时间服务器地址)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;nginx相关命令&quot;&gt;&lt;a href=&quot;#nginx相关命令&quot; class=&quot;headerlink&quot; title=&quot;nginx相关命令&quot;&gt;&lt;/a&gt;nginx相关命令&lt;/h4&gt;&lt;h5 id=&quot;重启nginx&quot;&gt;&lt;a href=&quot;#重启nginx&quot; class=&quot;he</summary>
      
    
    
    
    <category term="linux" scheme="https://www.980101.top/categories/linux/"/>
    
    
    <category term="linux" scheme="https://www.980101.top/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>安装compoer</title>
    <link href="https://www.980101.top/2023/03/08/%E5%AE%89%E8%A3%85compoer/"/>
    <id>https://www.980101.top/2023/03/08/%E5%AE%89%E8%A3%85compoer/</id>
    <published>2023-03-08T01:28:12.000Z</published>
    <updated>2025-04-19T14:56:47.299Z</updated>
    
    <content type="html"><![CDATA[<h5 id="1-下载composer"><a href="#1-下载composer" class="headerlink" title="1.下载composer"></a>1.下载composer</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sS https://getcomposer.org/installer | php</span><br></pre></td></tr></table></figure><h5 id="2-将composer-phar移动到-usr-local-bin-composer"><a href="#2-将composer-phar移动到-usr-local-bin-composer" class="headerlink" title="2.将composer.phar移动到&#x2F;usr&#x2F;local&#x2F;bin&#x2F;composer"></a>2.将composer.phar移动到&#x2F;usr&#x2F;local&#x2F;bin&#x2F;composer</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv composer.phar /usr/local/bin/composer</span><br></pre></td></tr></table></figure><h5 id="3-改为中国镜像"><a href="#3-改为中国镜像" class="headerlink" title="3.改为中国镜像"></a>3.改为中国镜像</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer config -g repo.packagist composer https://packagist.phpcomposer.com</span><br></pre></td></tr></table></figure><h5 id="4-移除镜像"><a href="#4-移除镜像" class="headerlink" title="4.移除镜像"></a>4.移除镜像</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer config -g --unset repos.packagist</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h5 id=&quot;1-下载composer&quot;&gt;&lt;a href=&quot;#1-下载composer&quot; class=&quot;headerlink&quot; title=&quot;1.下载composer&quot;&gt;&lt;/a&gt;1.下载composer&lt;/h5&gt;&lt;figure class=&quot;highlight cmd&quot;&gt;&lt;ta</summary>
      
    
    
    
    <category term="linux" scheme="https://www.980101.top/categories/linux/"/>
    
    
    <category term="linux" scheme="https://www.980101.top/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>腾讯云服务器修改root账号密码</title>
    <link href="https://www.980101.top/2023/03/08/%E8%85%BE%E8%AE%AF%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%AE%E6%94%B9root%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81/"/>
    <id>https://www.980101.top/2023/03/08/%E8%85%BE%E8%AE%AF%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%AE%E6%94%B9root%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81/</id>
    <published>2023-03-08T01:27:25.000Z</published>
    <updated>2025-04-19T14:49:15.395Z</updated>
    
    <content type="html"><![CDATA[<h5 id="1-通过shell登录服务器"><a href="#1-通过shell登录服务器" class="headerlink" title="1.通过shell登录服务器"></a>1.通过shell登录服务器</h5><h5 id="2-进入云端之后-输入如下命令"><a href="#2-进入云端之后-输入如下命令" class="headerlink" title="2.进入云端之后,输入如下命令"></a>2.进入云端之后,输入如下命令</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure><h5 id="3-输入密码-再次输入确认密码"><a href="#3-输入密码-再次输入确认密码" class="headerlink" title="3.输入密码,再次输入确认密码"></a>3.输入密码,再次输入确认密码</h5><h5 id="4-设置成功之后-输入如下命令-并回车"><a href="#4-设置成功之后-输入如下命令-并回车" class="headerlink" title="4.设置成功之后 输入如下命令,并回车"></a>4.设置成功之后 输入如下命令,并回车</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><h5 id="5-找到Authentication-修改如下"><a href="#5-找到Authentication-修改如下" class="headerlink" title="5.找到Authentication:  修改如下"></a>5.找到Authentication:  修改如下</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LoginGeaceTime值改为-&gt; <span class="number">120</span></span><br><span class="line">PermitRootLogin值改为-&gt; yes</span><br></pre></td></tr></table></figure><h5 id="6-保存并退出"><a href="#6-保存并退出" class="headerlink" title="6.保存并退出"></a>6.保存并退出</h5><h5 id="7-重启ssh"><a href="#7-重启ssh" class="headerlink" title="7.重启ssh"></a>7.重启ssh</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service ssh  restart</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h5 id=&quot;1-通过shell登录服务器&quot;&gt;&lt;a href=&quot;#1-通过shell登录服务器&quot; class=&quot;headerlink&quot; title=&quot;1.通过shell登录服务器&quot;&gt;&lt;/a&gt;1.通过shell登录服务器&lt;/h5&gt;&lt;h5 id=&quot;2-进入云端之后-输入如下命令&quot;&gt;</summary>
      
    
    
    
    <category term="linux" scheme="https://www.980101.top/categories/linux/"/>
    
    
    <category term="linux" scheme="https://www.980101.top/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>nginx+php配置文件</title>
    <link href="https://www.980101.top/2023/03/08/nginx-php%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"/>
    <id>https://www.980101.top/2023/03/08/nginx-php%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</id>
    <published>2023-03-08T01:26:36.000Z</published>
    <updated>2025-04-19T14:49:25.612Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    server_name test.second.<span class="number">980101</span>.top; # 域名(需要修改)</span><br><span class="line">    root <span class="string">&quot;/data/website/test/&quot;</span>; #目录名(需要修改)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">index</span> <span class="built_in">index</span>.html <span class="built_in">index</span>.htm <span class="built_in">index</span>.php;</span><br><span class="line"></span><br><span class="line">    charset utf-<span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ /<span class="built_in">index</span>.php?$query_string;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location = /favicon.ico &#123; access_log off; log_not_found off; &#125;</span><br><span class="line">    location = /robots.txt  &#123; access_log off; log_not_found off; &#125;</span><br><span class="line"></span><br><span class="line">    access_log off;</span><br><span class="line">    error_log  /var/<span class="built_in">log</span>/nginx/test.<span class="built_in">log</span> error; #错误日志位置(需要修改)</span><br><span class="line"></span><br><span class="line">    sendfile off;</span><br><span class="line"></span><br><span class="line">    client_max_body_size <span class="number">100</span><span class="keyword">m</span>;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        fastcgi_split_path_info ^(.+\.php)(/.+)$;</span><br><span class="line">        fastcgi_pass unix:/var/run/php/php7.<span class="number">2</span>-fpm.sock; </span><br><span class="line">        fastcgi_index <span class="built_in">index</span>.php;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        fastcgi_intercept_errors off;</span><br><span class="line">        fastcgi_buffer_size <span class="number">16</span><span class="keyword">k</span>;</span><br><span class="line">        fastcgi_buffers <span class="number">4</span> <span class="number">16</span><span class="keyword">k</span>;</span><br><span class="line">        fastcgi_connect_timeout <span class="number">300</span>;</span><br><span class="line">        fastcgi_send_timeout <span class="number">300</span>;</span><br><span class="line">        fastcgi_read_timeout <span class="number">300</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ /\.ht &#123;</span><br><span class="line">        deny <span class="keyword">all</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight vim&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;</summary>
      
    
    
    
    <category term="linux" scheme="https://www.980101.top/categories/linux/"/>
    
    <category term="nginx" scheme="https://www.980101.top/categories/linux/nginx/"/>
    
    
    <category term="linux" scheme="https://www.980101.top/tags/linux/"/>
    
    <category term="nginx" scheme="https://www.980101.top/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Dcat一键生成权限列表,备份菜单等</title>
    <link href="https://www.980101.top/2023/02/06/Dcat%E4%B8%80%E9%94%AE%E7%94%9F%E6%88%90%E6%9D%83%E9%99%90%E5%88%97%E8%A1%A8-%E5%A4%87%E4%BB%BD%E8%8F%9C%E5%8D%95%E7%AD%89/"/>
    <id>https://www.980101.top/2023/02/06/Dcat%E4%B8%80%E9%94%AE%E7%94%9F%E6%88%90%E6%9D%83%E9%99%90%E5%88%97%E8%A1%A8-%E5%A4%87%E4%BB%BD%E8%8F%9C%E5%8D%95%E7%AD%89/</id>
    <published>2023-02-06T07:36:17.000Z</published>
    <updated>2025-04-19T14:46:49.029Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Console</span>\<span class="title class_">Commands</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Str</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Console</span>\<span class="title">Command</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">DB</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Storage</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GeneratePermission</span> <span class="keyword">extends</span> <span class="title">Command</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">#命令</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$signature</span> = <span class="string">&#x27;admin:menu-permission&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#描述</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$description</span> = <span class="string">&#x27;备份菜单,填充菜单数据,填充权限&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#磁盘地址</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$disk</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#备份文件路径</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$backup_path</span> = <span class="string">&#x27;backup/menu.bak&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#菜单模型</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$menu_model</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#权限模型</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$permission_model</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#菜单,权限中间表名</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$permission_menu_table</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new command instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;menu_model = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;admin.database.menu_model&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;permission_model = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;admin.database.permissions_model&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;permission_menu_table = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;admin.database.permission_menu_table&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;disk = <span class="title class_">Storage</span>::<span class="title function_ invoke__">disk</span>(<span class="title function_ invoke__">config</span>(<span class="string">&#x27;admin.upload.disk&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/5/7 10:40</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$type</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">choice</span>(<span class="string">&#x27;请选择要执行的步骤&#x27;</span>, [</span><br><span class="line">            <span class="string">&#x27;备份菜单&#x27;</span>, <span class="string">&#x27;填充权限&#x27;</span>, <span class="string">&#x27;填充菜单&#x27;</span></span><br><span class="line">        ],<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$type</span>)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;备份菜单&#x27;</span>:</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">generateBackup</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;填充权限&#x27;</span>:</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">fillpermission</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;填充菜单&#x27;</span>:</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">fillMenu</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;请选择要执行的步骤&#x27;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:生成备份文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/5/7 9:46</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">generateBackup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">#获取菜单数据</span></span><br><span class="line">        <span class="variable">$arr</span> = <span class="title function_ invoke__">optional</span>((<span class="keyword">new</span> <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">menu_model</span>())-&gt;<span class="title function_ invoke__">get</span>())-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">        <span class="comment">#写入文件</span></span><br><span class="line">        <span class="variable">$res</span> = <span class="variable language_">$this</span>-&gt;disk-&gt;<span class="title function_ invoke__">put</span>(<span class="variable">$this</span>-&gt;backup_path, <span class="title function_ invoke__">serialize</span>(<span class="variable">$arr</span>));</span><br><span class="line">        <span class="variable">$res</span> ? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;备份成功&#x27;</span>) : <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;备份失败&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:填充权限</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/5/7 10:54</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">fillPermission</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$disk</span> = <span class="variable language_">$this</span>-&gt;disk;</span><br><span class="line">        <span class="comment">#判断备份文件是否存在</span></span><br><span class="line">        <span class="variable">$exist</span> = <span class="variable">$disk</span>-&gt;<span class="title function_ invoke__">exists</span>(<span class="variable">$this</span>-&gt;backup_path);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$exist</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;请先进行菜单备份&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#获取数据并反序列化</span></span><br><span class="line">        <span class="variable">$menu</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$disk</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;backup_path));</span><br><span class="line">        <span class="comment">#数据组装</span></span><br><span class="line">        <span class="variable">$permission</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">generatePermissions</span>(<span class="variable">$menu</span>);</span><br><span class="line">        DB::<span class="title function_ invoke__">beginTransaction</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;清除权限表...&#x27;</span>);</span><br><span class="line">            <span class="comment">#清空权限表</span></span><br><span class="line">            (<span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">permission_model</span>())-&gt;<span class="title function_ invoke__">truncate</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;清除完成&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;填充权限...&#x27;</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">withProgressBar</span>(<span class="variable">$permission</span>, function (<span class="variable">$permission</span>)&#123;</span><br><span class="line">                <span class="comment">#填充权限表</span></span><br><span class="line">                (<span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">permission_model</span>())-&gt;<span class="title function_ invoke__">insert</span>(<span class="variable">$permission</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">newLine</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;权限填充完成&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;清除权限菜单中间表...&#x27;</span>);</span><br><span class="line">            <span class="comment">#清空权限,菜单中间表</span></span><br><span class="line">            DB::<span class="title function_ invoke__">table</span>(<span class="variable">$this</span>-&gt;permission_menu_table)-&gt;<span class="title function_ invoke__">truncate</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;清除完成&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;填充权限菜单中间表...&#x27;</span>);</span><br><span class="line">            <span class="variable">$bar</span> = <span class="variable language_">$this</span>-&gt;output-&gt;<span class="title function_ invoke__">createProgressBar</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$permission</span>));</span><br><span class="line">            <span class="variable">$bar</span>-&gt;<span class="title function_ invoke__">start</span>();</span><br><span class="line">            <span class="comment">#循环插入权限菜单中间表</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$permission</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">                <span class="variable">$query</span> = DB::<span class="title function_ invoke__">table</span>(<span class="variable">$this</span>-&gt;permission_menu_table);</span><br><span class="line">                <span class="comment">#菜单id和权限id</span></span><br><span class="line">                <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">insert</span>([</span><br><span class="line">                    <span class="string">&#x27;permission_id&#x27;</span> =&gt; <span class="variable">$item</span>[<span class="string">&#x27;id&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;menu_id&#x27;</span>       =&gt; <span class="variable">$item</span>[<span class="string">&#x27;id&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;created_at&#x27;</span>    =&gt; <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>),</span><br><span class="line">                    <span class="string">&#x27;updated_at&#x27;</span>    =&gt; <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>),</span><br><span class="line">                ]);</span><br><span class="line">                <span class="comment">#如果不是顶级,则另外绑定父级菜单</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$item</span>[<span class="string">&#x27;parent_id&#x27;</span>] != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">recursive</span>(<span class="variable">$item</span>[<span class="string">&#x27;id&#x27;</span>], <span class="variable">$item</span>[<span class="string">&#x27;parent_id&#x27;</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$bar</span>-&gt;<span class="title function_ invoke__">advance</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$bar</span>-&gt;<span class="title function_ invoke__">finish</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">newLine</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;权限菜单中间表填充完成&#x27;</span>);</span><br><span class="line">            DB::<span class="title function_ invoke__">commit</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;权限填充完成&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$exception</span>)&#123;</span><br><span class="line">            DB::<span class="title function_ invoke__">rollBack</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="variable">$exception</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">newLine</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;权限填充失败&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:递归,添加权限(为了有三级或者四级的菜单的情况)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $parent_id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/5/16 16:47</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">recursive</span>(<span class="params"><span class="variable">$id</span>, <span class="variable">$parent_id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$parent_id</span> != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$query</span> = DB::<span class="title function_ invoke__">table</span>(<span class="variable">$this</span>-&gt;permission_menu_table);</span><br><span class="line">            <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">insert</span>([</span><br><span class="line">                <span class="string">&#x27;permission_id&#x27;</span> =&gt; <span class="variable">$id</span>,</span><br><span class="line">                <span class="string">&#x27;menu_id&#x27;</span> =&gt; <span class="variable">$parent_id</span>,</span><br><span class="line">                <span class="string">&#x27;created_at&#x27;</span>    =&gt; <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>),</span><br><span class="line">                <span class="string">&#x27;updated_at&#x27;</span>    =&gt; <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>),</span><br><span class="line">            ]);</span><br><span class="line">            <span class="variable">$parent_id</span> = (<span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">permission_model</span>())-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;id&#x27;</span>, <span class="variable">$parent_id</span>)-&gt;<span class="title function_ invoke__">value</span>(<span class="string">&#x27;parent_id&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$parent_id</span> != <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">recursive</span>(<span class="variable">$id</span>, <span class="variable">$parent_id</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:填充菜单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/5/7 13:20</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">fillMenu</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$disk</span> = <span class="variable language_">$this</span>-&gt;disk;</span><br><span class="line">        <span class="comment">#判断备份文件是否存在</span></span><br><span class="line">        <span class="variable">$exist</span> = <span class="variable">$disk</span>-&gt;<span class="title function_ invoke__">exists</span>(<span class="variable">$this</span>-&gt;backup_path);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$exist</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;请先进行菜单备份&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#获取数据并反序列化</span></span><br><span class="line">        <span class="variable">$menu</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$disk</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;backup_path));</span><br><span class="line">        DB::<span class="title function_ invoke__">beginTransaction</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;清除菜单表...&#x27;</span>);</span><br><span class="line">            <span class="comment">#清空菜单表</span></span><br><span class="line">            (<span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">menu_model</span>())-&gt;<span class="title function_ invoke__">truncate</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;清除完成&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;填充菜单...&#x27;</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">withProgressBar</span>(<span class="variable">$menu</span>, function (<span class="variable">$menu</span>)&#123;</span><br><span class="line">                <span class="comment">#菜单表数据填充</span></span><br><span class="line">                (<span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">menu_model</span>())-&gt;<span class="title function_ invoke__">insert</span>(<span class="variable">$menu</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">newLine</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;菜单填充完成&#x27;</span>);</span><br><span class="line">            DB::<span class="title function_ invoke__">commit</span>();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$exception</span>)&#123;</span><br><span class="line">            DB::<span class="title function_ invoke__">rollBack</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="variable">$exception</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">newLine</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;填充失败&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:生成权限</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $menu</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/5/7 10:47</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">generatePermissions</span>(<span class="params"><span class="variable">$menu</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$permissions</span> = [];</span><br><span class="line">        <span class="comment">#循环整合数据</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$menu</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">            <span class="comment">#第一条不加入权限(第一条为主页,默认所有管理员都可以看到)</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$item</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="variable">$temp</span> = [];</span><br><span class="line"></span><br><span class="line">            <span class="variable">$temp</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$item</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">            <span class="variable">$temp</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$item</span>[<span class="string">&#x27;title&#x27;</span>];</span><br><span class="line">            <span class="variable">$temp</span>[<span class="string">&#x27;slug&#x27;</span>] = (<span class="keyword">string</span>)<span class="title class_">Str</span>::<span class="title function_ invoke__">uuid</span>();</span><br><span class="line">            <span class="variable">$temp</span>[<span class="string">&#x27;http_path&#x27;</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getHttpPath</span>(<span class="variable">$item</span>[<span class="string">&#x27;uri&#x27;</span>]);</span><br><span class="line">            <span class="variable">$temp</span>[<span class="string">&#x27;order&#x27;</span>] = <span class="variable">$item</span>[<span class="string">&#x27;order&#x27;</span>];</span><br><span class="line">            <span class="variable">$temp</span>[<span class="string">&#x27;parent_id&#x27;</span>] = <span class="variable">$item</span>[<span class="string">&#x27;parent_id&#x27;</span>];</span><br><span class="line">            <span class="variable">$temp</span>[<span class="string">&#x27;created_at&#x27;</span>] = <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>);</span><br><span class="line">            <span class="variable">$temp</span>[<span class="string">&#x27;updated_at&#x27;</span>] = <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable">$permissions</span>[] = <span class="variable">$temp</span>;</span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable">$temp</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$permissions</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:生成权限链接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $uri</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/5/7 10:47</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">getHttpPath</span>(<span class="params"><span class="variable">$uri</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$uri</span> == <span class="string">&#x27;/&#x27;</span> || <span class="variable">$uri</span> == <span class="string">&#x27;&#x27;</span>) <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$uri</span>, <span class="string">&#x27;/&#x27;</span>) !== <span class="number">0</span>)  <span class="variable">$uri</span> = <span class="string">&#x27;/&#x27;</span> . <span class="variable">$uri</span>;</span><br><span class="line">        <span class="comment">#为了防止有两个一样的路由故这样写,例如 /index 和 /index-a 等</span></span><br><span class="line">        <span class="comment">#如果没有可以直接写成 $uri . &#x27;*&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$uri</span> . <span class="string">&#x27;,&#x27;</span> . <span class="variable">$uri</span> . <span class="string">&#x27;/*&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;</summary>
      
    
    
    
    <category term="laravel" scheme="https://www.980101.top/categories/laravel/"/>
    
    <category term="dcat-admin" scheme="https://www.980101.top/categories/laravel/dcat-admin/"/>
    
    
    <category term="dcat-admin" scheme="https://www.980101.top/tags/dcat-admin/"/>
    
    <category term="命令行" scheme="https://www.980101.top/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>ckeditor文件上传并在dcat中使用</title>
    <link href="https://www.980101.top/2023/02/06/ckeditor%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%B9%B6%E5%9C%A8dcat%E4%B8%AD%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.980101.top/2023/02/06/ckeditor%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%B9%B6%E5%9C%A8dcat%E4%B8%AD%E4%BD%BF%E7%94%A8/</id>
    <published>2023-02-06T07:34:29.000Z</published>
    <updated>2025-04-19T14:45:48.980Z</updated>
    
    <content type="html"><![CDATA[<h5 id="去掉预览中的文字"><a href="#去掉预览中的文字" class="headerlink" title="去掉预览中的文字"></a>去掉预览中的文字</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为了去掉预览中的文字</span></span><br><span class="line">在ckeditor/plugins/image/dialogs/image.js</span><br><span class="line">搜索“d.config.image_previewText”，把(d.config.image_previewText||”)加粗的内容全删了。</span><br></pre></td></tr></table></figure><h5 id="开启上传功能"><a href="#开启上传功能" class="headerlink" title="开启上传功能"></a>开启上传功能</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在ckeditor/plugins/image/dialogs/image.js</span><br><span class="line">搜索：id:’Upload’,hidden:!<span class="number">0</span></span><br><span class="line">实际上上传功能被隐藏了，把上面的!<span class="number">0</span>改成<span class="literal">false</span>。</span><br></pre></td></tr></table></figure><h5 id="定义上传文件时的action"><a href="#定义上传文件时的action" class="headerlink" title="定义上传文件时的action"></a>定义上传文件时的action</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.filebrowserUploadUrl = <span class="string">&#x27;/index.php?action=address&amp;do=upload&#x27;</span>; <span class="comment">//地址自定义</span></span><br></pre></td></tr></table></figure><h5 id="在php处理文件中加入upload方法"><a href="#在php处理文件中加入upload方法" class="headerlink" title="在php处理文件中加入upload方法;"></a>在php处理文件中加入upload方法;</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$name</span> = <span class="string">&#x27;upload&#x27;</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">hasFile</span>(<span class="variable">$name</span>))&#123;</span><br><span class="line">          <span class="comment">//获取文件</span></span><br><span class="line">          <span class="variable">$file</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="variable">$name</span>);</span><br><span class="line">          <span class="variable">$time</span> = <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Ymd&#x27;</span>,<span class="title function_ invoke__">time</span>());</span><br><span class="line">          <span class="comment">// 文件是否上传成功</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">isValid</span>()) &#123;</span><br><span class="line">              <span class="comment">// 获取文件相关信息</span></span><br><span class="line">              <span class="variable">$originalName</span> = <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientOriginalName</span>(); <span class="comment">// 文件原名</span></span><br><span class="line">              <span class="variable">$ext</span> = <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientOriginalExtension</span>();     <span class="comment">// 扩展名</span></span><br><span class="line">              <span class="variable">$realPath</span> = <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getRealPath</span>();   <span class="comment">//临时文件的绝对路径</span></span><br><span class="line">              <span class="variable">$type</span> = <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientMimeType</span>();     <span class="comment">// image/jpeg</span></span><br><span class="line">              <span class="comment">// 上传文件</span></span><br><span class="line">              <span class="variable">$filename</span> = <span class="title function_ invoke__">uniqid</span>() . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$ext</span>;</span><br><span class="line">              <span class="variable">$path</span> = <span class="string">&#x27;editor/&#x27;</span>.<span class="variable">$time</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$filename</span>;</span><br><span class="line">              <span class="comment">//这里的uploads是配置文件的名称</span></span><br><span class="line">              <span class="variable">$bool</span> = <span class="title class_">Storage</span>::<span class="title function_ invoke__">disk</span>(<span class="string">&#x27;admin&#x27;</span>)-&gt;<span class="title function_ invoke__">put</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$path</span>, <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$realPath</span>));</span><br><span class="line">              <span class="comment">//判断是否创建成功</span></span><br><span class="line">              <span class="keyword">if</span> (!<span class="variable">$bool</span>) <span class="keyword">return</span> <span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">json</span>([</span><br><span class="line">                  <span class="string">&#x27;uploaded&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">                  <span class="string">&#x27;error&#x27;</span> =&gt; <span class="string">&#x27;上传失败&#x27;</span>,</span><br><span class="line">              ]);</span><br><span class="line">              <span class="keyword">return</span> <span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">json</span>([</span><br><span class="line">                  <span class="string">&#x27;uploaded&#x27;</span> =&gt; <span class="number">1</span>,</span><br><span class="line">                  <span class="string">&quot;fileName&quot;</span> =&gt; <span class="variable">$filename</span>,</span><br><span class="line">                  <span class="string">&quot;url&quot;</span> =&gt; <span class="string">&#x27;/upload/&#x27;</span>.<span class="variable">$path</span></span><br><span class="line">              ]);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">json</span>([</span><br><span class="line">          <span class="string">&#x27;uploaded&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">          <span class="string">&#x27;error&#x27;</span> =&gt; <span class="string">&#x27;上传失败&#x27;</span>,</span><br><span class="line">      ]);</span><br></pre></td></tr></table></figure><h5 id="bootstrap中引用"><a href="#bootstrap中引用" class="headerlink" title="bootstrap中引用"></a>bootstrap中引用</h5><blockquote><p>注册前端组件别名</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//(/dcat/editor/ 即你ckeditor存放目录,</span></span><br><span class="line"><span class="comment">//这里放在了,public/dcat/editor/ckeditor)</span></span><br><span class="line"><span class="title class_">Admin</span>::<span class="title function_ invoke__">asset</span>()-&gt;<span class="title function_ invoke__">alias</span>(<span class="string">&#x27;@ckeditor&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;js&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;/dcat/editor/ckeditor/ckeditor.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;/dcat/editor/ckeditor/adapters/jquery.js&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><h5 id="在Admin-Extensions-Form创建一个php文件-命名为CKEditor"><a href="#在Admin-Extensions-Form创建一个php文件-命名为CKEditor" class="headerlink" title="在Admin&#x2F;Extensions&#x2F;Form创建一个php文件(命名为CKEditor)"></a>在Admin&#x2F;Extensions&#x2F;Form创建一个php文件(命名为CKEditor)</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Extensions</span>\<span class="title class_">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>\<span class="title">Field</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CKEditor</span> <span class="keyword">extends</span> <span class="title">Field</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 视图文件路径</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$view</span> = <span class="string">&#x27;admin.editor.ckeditor&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="在bootstrap注册组件"><a href="#在bootstrap注册组件" class="headerlink" title="在bootstrap注册组件"></a>在bootstrap注册组件</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Extensions</span>\<span class="title">Form</span>\<span class="title">CKEditor</span>;</span><br><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">extend</span>(<span class="string">&#x27;ckeditor&#x27;</span>, <span class="title class_">CKEditor</span>::<span class="variable language_">class</span>);</span><br></pre></td></tr></table></figure><h5 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">ckeditor</span>(<span class="string">&#x27;content&#x27;</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h5 id=&quot;去掉预览中的文字&quot;&gt;&lt;a href=&quot;#去掉预览中的文字&quot; class=&quot;headerlink&quot; title=&quot;去掉预览中的文字&quot;&gt;&lt;/a&gt;去掉预览中的文字&lt;/h5&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td clas</summary>
      
    
    
    
    <category term="laravel" scheme="https://www.980101.top/categories/laravel/"/>
    
    <category term="dcat-admin" scheme="https://www.980101.top/categories/laravel/dcat-admin/"/>
    
    
    <category term="dcat-admin" scheme="https://www.980101.top/tags/dcat-admin/"/>
    
    <category term="ckeditor" scheme="https://www.980101.top/tags/ckeditor/"/>
    
  </entry>
  
  <entry>
    <title>Dcat插件</title>
    <link href="https://www.980101.top/2023/02/06/Dcat%E6%8F%92%E4%BB%B6/"/>
    <id>https://www.980101.top/2023/02/06/Dcat%E6%8F%92%E4%BB%B6/</id>
    <published>2023-02-06T07:33:47.000Z</published>
    <updated>2025-04-19T14:44:56.106Z</updated>
    
    <content type="html"><![CDATA[<h4 id="百度编辑器"><a href="#百度编辑器" class="headerlink" title="百度编辑器"></a>百度编辑器</h4><blockquote><p>composer 安装</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require weiaibaicai/ueditor</span><br></pre></td></tr></table></figure><blockquote><p>启用插件</p></blockquote><p>开发工具 -&gt; 扩展 -&gt; weiaibaicai.ueditor -&gt; 升级 -&gt; 启用</p><blockquote><p>发布配置 ueditor.php</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --provider=&quot;Weiaibaicai\Ueditor\UeditorServiceProvider&quot;</span><br></pre></td></tr></table></figure><blockquote><p>方法使用</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">ueditor</span>(<span class="string">&#x27;content&#x27;</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;百度编辑器&quot;&gt;&lt;a href=&quot;#百度编辑器&quot; class=&quot;headerlink&quot; title=&quot;百度编辑器&quot;&gt;&lt;/a&gt;百度编辑器&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;composer 安装&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;</summary>
      
    
    
    
    <category term="laravel" scheme="https://www.980101.top/categories/laravel/"/>
    
    <category term="dcat-admin" scheme="https://www.980101.top/categories/laravel/dcat-admin/"/>
    
    
    <category term="dcat-admin" scheme="https://www.980101.top/tags/dcat-admin/"/>
    
  </entry>
  
  <entry>
    <title>Dcat易错保存</title>
    <link href="https://www.980101.top/2022/09/01/Dcat%E6%98%93%E9%94%99%E4%BF%9D%E5%AD%98/"/>
    <id>https://www.980101.top/2022/09/01/Dcat%E6%98%93%E9%94%99%E4%BF%9D%E5%AD%98/</id>
    <published>2022-09-01T03:06:49.000Z</published>
    <updated>2025-04-19T14:44:14.927Z</updated>
    
    <content type="html"><![CDATA[<h4 id="使用form表单中的array组件"><a href="#使用form表单中的array组件" class="headerlink" title="使用form表单中的array组件"></a>使用form表单中的array组件</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># array字段的名字和内部生成的名字不能一致，不然保存会出现问题代码如下：</span></span><br><span class="line"><span class="comment">#错误示例</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="keyword">array</span>(<span class="string">&#x27;content&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Form\NestedForm <span class="variable">$form</span></span>)</span>&#123;</span><br><span class="line">     <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;内容&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">#正确 (content 和 contents 要区分开)</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="keyword">array</span>(<span class="string">&#x27;content&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Form\NestedForm <span class="variable">$form</span></span>)</span>&#123;</span><br><span class="line">     <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;contents&#x27;</span>, <span class="string">&#x27;内容&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="使用多图上传"><a href="#使用多图上传" class="headerlink" title="使用多图上传"></a>使用多图上传</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如果出现 foreach之类的报错，可以在后面添加autoSave(false)即可;</span></span><br><span class="line"><span class="comment">#示例</span></span><br><span class="line">  <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleImage</span>(<span class="string">&#x27;img&#x27;</span>, <span class="string">&#x27;图片&#x27;</span>)</span><br><span class="line">  -&gt;<span class="title function_ invoke__">autoUpload</span>()-&gt;<span class="title function_ invoke__">uniqueName</span>()-&gt;<span class="title function_ invoke__">required</span>()</span><br><span class="line">  -&gt;<span class="title function_ invoke__">removable</span>(<span class="literal">false</span>)-&gt;<span class="title function_ invoke__">autoSave</span>(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure><h4 id="form工具表单"><a href="#form工具表单" class="headerlink" title="form工具表单"></a>form工具表单</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在工具表单中使用array之类的json组件，并在json组件中使用图片上传，后续会无法修改</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;使用form表单中的array组件&quot;&gt;&lt;a href=&quot;#使用form表单中的array组件&quot; class=&quot;headerlink&quot; title=&quot;使用form表单中的array组件&quot;&gt;&lt;/a&gt;使用form表单中的array组件&lt;/h4&gt;&lt;figure class</summary>
      
    
    
    
    <category term="laravel" scheme="https://www.980101.top/categories/laravel/"/>
    
    <category term="dcat-admin" scheme="https://www.980101.top/categories/laravel/dcat-admin/"/>
    
    
    <category term="dcat-admin" scheme="https://www.980101.top/tags/dcat-admin/"/>
    
  </entry>
  
  <entry>
    <title>sql命令行</title>
    <link href="https://www.980101.top/2022/08/24/sql%E5%91%BD%E4%BB%A4%E8%A1%8C/"/>
    <id>https://www.980101.top/2022/08/24/sql%E5%91%BD%E4%BB%A4%E8%A1%8C/</id>
    <published>2022-08-24T07:55:02.000Z</published>
    <updated>2025-04-19T15:05:58.293Z</updated>
    
    <content type="html"><![CDATA[<p>sql命令行</p><span id="more"></span><h5 id="查看所有数据库"><a href="#查看所有数据库" class="headerlink" title="查看所有数据库"></a>查看所有数据库</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show  databases;</span><br></pre></td></tr></table></figure><h5 id="切换数据库"><a href="#切换数据库" class="headerlink" title="切换数据库"></a>切换数据库</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br></pre></td></tr></table></figure><h5 id="查看当前数据库所有表"><a href="#查看当前数据库所有表" class="headerlink" title="查看当前数据库所有表"></a>查看当前数据库所有表</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br></pre></td></tr></table></figure><h5 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h5><blockquote><p>此处数据库名要以字母开头</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database a_111; </span><br></pre></td></tr></table></figure><h5 id="创建数据库用户-mysql8-0以前"><a href="#创建数据库用户-mysql8-0以前" class="headerlink" title="创建数据库用户(mysql8.0以前)"></a>创建数据库用户(mysql8.0以前)</h5><blockquote><p>注意此处的数据库名是被 &#96;&#96;所包括,并不是被单引号所包括</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant all on `数据库`.* to &#x27;用户名&#x27;@&#x27;%&#x27; identified by &#x27;密码&#x27;;</span><br></pre></td></tr></table></figure><h5 id="创建数据库用户-mysql8-0"><a href="#创建数据库用户-mysql8-0" class="headerlink" title="创建数据库用户(mysql8.0)"></a>创建数据库用户(mysql8.0)</h5><blockquote><ol><li>创建新用户()</li></ol></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create user `用户名`@`host` identified by &#x27;密码&#x27;;</span><br></pre></td></tr></table></figure><p>注:host是可写%即任意ip都可访问,或者写localhost即只能本地访问</p><blockquote><p>2.赋予权限</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant all privileges on `数据库名`.* to `用户名`@&#x27;%&#x27; with grant option;</span><br></pre></td></tr></table></figure><blockquote><p>3.授权成功后刷新权限</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h5 id="取消权限"><a href="#取消权限" class="headerlink" title="取消权限"></a>取消权限</h5><blockquote><p>用户有什么权限就撤什么权限</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">revoke all privileges on *.* from &#x27;test1&#x27;@&#x27;localhost&#x27;;</span><br></pre></td></tr></table></figure><h5 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop user &#x27;test1&#x27;@&#x27;localhost&#x27;;</span><br></pre></td></tr></table></figure><h5 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter user &#x27;laravel&#x27;@&#x27;localhost&#x27; identified with MYSQL_NATIVE_PASSWORD by &#x27;laravel@<span class="number">123</span>&#x27;;</span><br></pre></td></tr></table></figure><h5 id="修改数据库可外部连接"><a href="#修改数据库可外部连接" class="headerlink" title="修改数据库可外部连接"></a>修改数据库可外部连接</h5><blockquote><p>此方式只适用于mysql8 以下</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">到mysql目录下找到配置文件,即mysqld.cnf(可能此文件有很多个,找到正在执行的那个)</span><br><span class="line">把 bind-address的值从<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>改为<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line">然后保存,重启服务</span><br><span class="line">即可外部访问</span><br></pre></td></tr></table></figure><blockquote><p>mysql8 只需要赋予账号host&#x3D;%即可</p></blockquote><h5 id="导入导出sql文件"><a href="#导入导出sql文件" class="headerlink" title="导入导出sql文件"></a>导入导出sql文件</h5><blockquote><p>导出</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p 数据库名 &gt; 文件.sql </span><br></pre></td></tr></table></figure><blockquote><p>导入</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.在命令行不进入mysql操作</span><br><span class="line">mysql -uroot -p 数据库名 &lt; 文件.sql</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.进入mysql操作</span><br><span class="line">mysql -uroot -p</span><br><span class="line">use 数据库名;</span><br><span class="line">source /data/sql/文件.sql;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;sql命令行&lt;/p&gt;</summary>
    
    
    
    <category term="mysql" scheme="https://www.980101.top/categories/mysql/"/>
    
    
    <category term="sql" scheme="https://www.980101.top/tags/sql/"/>
    
    <category term="mysql" scheme="https://www.980101.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Dcat-admin重写顶部右侧下拉列表</title>
    <link href="https://www.980101.top/2022/08/19/Dcat-admin%E9%87%8D%E5%86%99%E9%A1%B6%E9%83%A8%E5%8F%B3%E4%BE%A7%E4%B8%8B%E6%8B%89%E5%88%97%E8%A1%A8/"/>
    <id>https://www.980101.top/2022/08/19/Dcat-admin%E9%87%8D%E5%86%99%E9%A1%B6%E9%83%A8%E5%8F%B3%E4%BE%A7%E4%B8%8B%E6%8B%89%E5%88%97%E8%A1%A8/</id>
    <published>2022-08-19T07:10:45.000Z</published>
    <updated>2025-04-19T15:05:46.836Z</updated>
    
    <content type="html"><![CDATA[<p>Dcat-admin重写顶部右侧下拉列表</p><span id="more"></span><h5 id="第一步-创建重写右侧下拉列表页面"><a href="#第一步-创建重写右侧下拉列表页面" class="headerlink" title="第一步 创建重写右侧下拉列表页面"></a>第一步 创建重写右侧下拉列表页面</h5><blockquote><p>在resource&#x2F;view&#x2F;admin&#x2F;partials下创建navbar-user-panel.blade.php(路径,文件名可以自定义)</p><p>复制下拉列表内容,在vendor&#x2F;dcat&#x2F;laravel-admin&#x2F;resource&#x2F;view&#x2F;partials下的navbar-user-panel.blade.php</p></blockquote><p><strong>代码内容如下</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">if</span>(<span class="variable">$user</span>)</span><br><span class="line">&lt;li <span class="class"><span class="keyword">class</span>=&quot;<span class="title">dropdown</span> <span class="title">dropdown</span>-<span class="title">user</span> <span class="title">nav</span>-<span class="title">item</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">dropdown</span>-<span class="title">toggle</span> <span class="title">nav</span>-<span class="title">link</span> <span class="title">dropdown</span>-<span class="title">user</span>-<span class="title">link</span>&quot; <span class="title">href</span>=&quot;#&quot; <span class="title">data</span>-<span class="title">toggle</span>=&quot;<span class="title">dropdown</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">user</span>-<span class="title">nav</span> <span class="title">d</span>-<span class="title">sm</span>-<span class="title">flex</span> <span class="title">d</span>-<span class="title">none</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">user</span>-<span class="title">name</span> <span class="title">text</span>-<span class="title">bold</span>-600&quot;&gt;</span>&#123;&#123; <span class="variable">$user</span>-&gt;name &#125;&#125;&lt;/span&gt;</span><br><span class="line">            &lt;span <span class="class"><span class="keyword">class</span>=&quot;<span class="title">user</span>-<span class="title">status</span>&quot;&gt;&lt;<span class="title">i</span> <span class="title">class</span>=&quot;<span class="title">fa</span> <span class="title">fa</span>-<span class="title">circle</span> <span class="title">text</span>-<span class="title">success</span>&quot;&gt;&lt;/<span class="title">i</span>&gt; </span>&#123;&#123; <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.online&#x27;</span>) &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">            &lt;img <span class="class"><span class="keyword">class</span>=&quot;<span class="title">round</span>&quot; <span class="title">src</span>=&quot;%7<span class="title">B</span>%7<span class="title">B</span>%20%24<span class="title">user</span>-&gt;<span class="title">getAvatar</span>()%20%7<span class="title">D</span>%7<span class="title">D</span>&quot; <span class="title">alt</span>=&quot;<span class="title">avatar</span>&quot; <span class="title">height</span>=&quot;40&quot; <span class="title">width</span>=&quot;40&quot;&gt;&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">dropdown</span>-<span class="title">menu</span> <span class="title">dropdown</span>-<span class="title">menu</span>-<span class="title">right</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">a</span> <span class="title">href</span>=&quot;%7<span class="title">B</span>%7<span class="title">B</span>%20<span class="title">admin_url</span>(&#x27;<span class="title">auth</span>/<span class="title">setting</span>&#x27;)%20%7<span class="title">D</span>%7<span class="title">D</span>&quot; <span class="title">class</span>=&quot;<span class="title">dropdown</span>-<span class="title">item</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">i</span> <span class="title">class</span>=&quot;<span class="title">feather</span> <span class="title">icon</span>-<span class="title">user</span>&quot;&gt;&lt;/<span class="title">i</span>&gt; </span>&#123;&#123; <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.setting&#x27;</span>) &#125;&#125;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">dropdown</span>-<span class="title">divider</span>&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">dropdown</span>-<span class="title">item</span>&quot; <span class="title">href</span>=&quot;%7<span class="title">B</span>%7<span class="title">B</span>%20<span class="title">admin_url</span>(&#x27;<span class="title">auth</span>/<span class="title">logout</span>&#x27;)%20%7<span class="title">D</span>%7<span class="title">D</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">i</span> <span class="title">class</span>=&quot;<span class="title">feather</span> <span class="title">icon</span>-<span class="title">power</span>&quot;&gt;&lt;/<span class="title">i</span>&gt; </span>&#123;&#123; <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.logout&#x27;</span>) &#125;&#125;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure><h5 id="第二步-在其中加入如下代码-需要几个可以写几个"><a href="#第二步-在其中加入如下代码-需要几个可以写几个" class="headerlink" title="第二步 在其中加入如下代码(需要几个可以写几个)"></a>第二步 在其中加入如下代码(需要几个可以写几个)</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;%7B%7B%20admin_url(&#x27;auth/setting&#x27;)%20%7D%7D&quot;</span> <span class="class"><span class="keyword">class</span>=&quot;<span class="title">dropdown</span>-<span class="title">item</span>&quot;&gt;</span></span><br><span class="line"><span class="class">           &lt;<span class="title">i</span> <span class="title">class</span>=&quot;<span class="title">feather</span> <span class="title">icon</span>-<span class="title">user</span>&quot;&gt;&lt;/<span class="title">i</span>&gt; </span>&#123;&#123; <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.setting&#x27;</span>) &#125;&#125;</span><br><span class="line">       &lt;/a&gt;</span><br><span class="line"></span><br><span class="line">       &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">dropdown</span>-<span class="title">divider</span>&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>其中链接,图标文字可以自定义</strong></p><h5 id="第三步-在app-Admin-bootstrap-php中加入如下代码"><a href="#第三步-在app-Admin-bootstrap-php中加入如下代码" class="headerlink" title="第三步 在app&#x2F;Admin&#x2F;bootstrap.php中加入如下代码"></a>第三步 在app&#x2F;Admin&#x2F;bootstrap.php中加入如下代码</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">admin_inject_section</span>(<span class="title class_">Admin</span>::<span class="variable constant_">SECTION</span>[<span class="string">&#x27;NAVBAR_USER_PANEL&#x27;</span>], function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;admin.partials.navbar-user-panel&#x27;</span>, [<span class="string">&#x27;user&#x27;</span> =&gt; <span class="title class_">Admin</span>::<span class="title function_ invoke__">user</span>()]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="然后就可以啦"><a href="#然后就可以啦" class="headerlink" title="然后就可以啦"></a>然后就可以啦</h5>]]></content>
    
    
    <summary type="html">&lt;p&gt;Dcat-admin重写顶部右侧下拉列表&lt;/p&gt;</summary>
    
    
    
    <category term="laravel" scheme="https://www.980101.top/categories/laravel/"/>
    
    <category term="dcat-admin" scheme="https://www.980101.top/categories/laravel/dcat-admin/"/>
    
    
    <category term="dcat-admin" scheme="https://www.980101.top/tags/dcat-admin/"/>
    
  </entry>
  
  <entry>
    <title>Dcat-admin 自定义登录页面</title>
    <link href="https://www.980101.top/2022/08/19/Dcat-admin-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2/"/>
    <id>https://www.980101.top/2022/08/19/Dcat-admin-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2/</id>
    <published>2022-08-19T07:08:21.000Z</published>
    <updated>2025-04-19T15:05:37.091Z</updated>
    
    <content type="html"><![CDATA[<p>Dcat-admin 自定义登录页面样式</p><span id="more"></span><p><strong>为了不影响后续升级,选择重写登录页面</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">首先创建对应的视图文件</span><br><span class="line">在 resource/views/admin/login/ 创建对应文件  login.blade.php</span><br><span class="line">写入自己喜欢的布局,样式</span><br></pre></td></tr></table></figure><blockquote><h6 id="页面的注意事项-这都是基于不修改dcat的登录逻辑和会员表单"><a href="#页面的注意事项-这都是基于不修改dcat的登录逻辑和会员表单" class="headerlink" title="页面的注意事项(这都是基于不修改dcat的登录逻辑和会员表单)"></a>页面的注意事项(这都是基于不修改dcat的登录逻辑和会员表单)</h6></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.表单提交路径&#123;&#123; <span class="title function_ invoke__">admin_url</span>(<span class="string">&#x27;auth/login&#x27;</span>) &#125;&#125;</span><br><span class="line"><span class="number">2</span>.表单字段 用户名username  密码 password </span><br><span class="line"><span class="number">3</span>.表单提交js</span><br><span class="line">       Dcat.<span class="title function_ invoke__">ready</span>(function() &#123;</span><br><span class="line">        <span class="comment">// ajax表单提交</span></span><br><span class="line">        $(<span class="string">&#x27;#login-form&#x27;</span>).<span class="title function_ invoke__">form</span>(&#123;</span><br><span class="line">            <span class="attr">validate</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h5 id="最后一步"><a href="#最后一步" class="headerlink" title="最后一步"></a>最后一步</h5><blockquote><p>在app\Admin\Controllers\AuthController.php下添加如下代码</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$view</span> = <span class="string">&#x27;admin.login.login&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Dcat-admin 自定义登录页面样式&lt;/p&gt;</summary>
    
    
    
    <category term="laravel" scheme="https://www.980101.top/categories/laravel/"/>
    
    <category term="dcat-admin" scheme="https://www.980101.top/categories/laravel/dcat-admin/"/>
    
    
    <category term="dcat-admin" scheme="https://www.980101.top/tags/dcat-admin/"/>
    
  </entry>
  
  <entry>
    <title>创建Service命令</title>
    <link href="https://www.980101.top/2022/07/26/%E5%88%9B%E5%BB%BAService%E5%91%BD%E4%BB%A4/"/>
    <id>https://www.980101.top/2022/07/26/%E5%88%9B%E5%BB%BAService%E5%91%BD%E4%BB%A4/</id>
    <published>2022-07-26T01:39:43.000Z</published>
    <updated>2025-04-19T15:05:24.194Z</updated>
    
    <content type="html"><![CDATA[<p>创建Service命令</p><span id="more"></span><h1 id="使用以下命令生成命令行文件"><a href="#使用以下命令生成命令行文件" class="headerlink" title="使用以下命令生成命令行文件"></a>使用以下命令生成命令行文件</h1><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:command MakeService</span><br></pre></td></tr></table></figure><h1 id="命令文件"><a href="#命令文件" class="headerlink" title="命令文件"></a>命令文件</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">namespace</span> <span class="title class_">Ake</span>\<span class="title class_">Tools</span>\<span class="title class_">Commands</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Console</span>\<span class="title">GeneratorCommand</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Input</span>\<span class="title">InputOption</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MakeService</span> <span class="keyword">extends</span> <span class="title">GeneratorCommand</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The console command name.</span></span><br><span class="line"><span class="comment">     * 控制台命令名。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$name</span> = <span class="string">&#x27;make:service&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The console command description.</span></span><br><span class="line"><span class="comment">     * console命令说明。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$description</span> = <span class="string">&#x27;生成service对象类&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The type of class being generated.</span></span><br><span class="line"><span class="comment">     * 生成的类的类型。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$type</span> = <span class="string">&#x27;Service&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">buildClass</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$stub</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">buildClass</span>(<span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">option</span>(<span class="string">&#x27;base&#x27;</span>)) <span class="keyword">return</span> <span class="variable">$stub</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$model</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">option</span>(<span class="string">&#x27;model&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$model</span> ? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">replaceModel</span>(<span class="variable">$stub</span>, <span class="variable">$name</span>) : <span class="variable">$stub</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:Get the stub file for the generator.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:获取生成器的存根文件。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/5/24 10:50</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getStub</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">option</span>(<span class="string">&#x27;base&#x27;</span>)) <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">path</span>(<span class="string">&#x27;/stubs/service.base.stub&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">option</span>(<span class="string">&#x27;model&#x27;</span>) ?</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">path</span>(<span class="string">&#x27;/stubs/service.plain.stub&#x27;</span>) :</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">path</span>(<span class="string">&#x27;/stubs/service.stub&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:Get the default namespace for the class.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:获取默认命名空间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $rootNamespace</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/5/24 10:50</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getDefaultNamespace</span>(<span class="params"><span class="variable">$rootNamespace</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$rootNamespace</span> . <span class="string">&#x27;\Services&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:替换给定存根的模型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $stub</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array|string|string[]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/5/24 11:50</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">replaceModel</span>(<span class="params"><span class="variable">$stub</span>, <span class="variable">$model</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$modelClass</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">buildModel</span>(<span class="variable">$model</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$replace</span> = [</span><br><span class="line">            <span class="string">&#x27;DummyFullModelClass&#x27;</span> =&gt; <span class="variable">$modelClass</span>,</span><br><span class="line">            <span class="string">&#x27;&#123;&#123;namespacedModel&#125;&#125;&#x27;</span> =&gt; <span class="variable">$modelClass</span>,</span><br><span class="line">            <span class="string">&#x27;&#123;&#123; namespacedModel &#125;&#125;&#x27;</span> =&gt; <span class="variable">$modelClass</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(</span><br><span class="line">            <span class="title function_ invoke__">array_keys</span>(<span class="variable">$replace</span>), <span class="title function_ invoke__">array_values</span>(<span class="variable">$replace</span>), <span class="variable">$stub</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:构建model名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/5/24 11:47</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">buildModel</span>(<span class="params"><span class="variable">$model</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;([^A-Za-z0-9_/\\\\])&#x27;</span>, <span class="variable">$model</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\InvalidArgumentException</span>(<span class="string">&#x27;模型名称包含无效字符。&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">qualifyModel</span>(<span class="variable">$model</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:添加参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array[]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/5/24 13:04</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getOptions</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">#第一个参数,为变量名,即 --model 调用或者 --model= 调用</span></span><br><span class="line">        <span class="comment">#第二个参数,为别名,即简写 -m 调用</span></span><br><span class="line">        <span class="comment">#第三个参数,Symfony\Component\Console\Input\InputOption 中的常量 VALUE_NONE (bool)</span></span><br><span class="line">        <span class="comment">#第四个参数,为描述</span></span><br><span class="line">        <span class="comment">#第五个参数,为默认值 InputOption::VALUE_NONE 时必须为 null</span></span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            [<span class="string">&#x27;model&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="title class_">InputOption</span>::<span class="variable constant_">VALUE_NONE</span>, <span class="string">&#x27;是否关联 model &#x27;</span>],</span><br><span class="line">            [<span class="string">&#x27;base&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="title class_">InputOption</span>::<span class="variable constant_">VALUE_NONE</span>, <span class="string">&#x27;创建基类 service &#x27;</span>],</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">path</span>(<span class="params"><span class="variable">$path</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">__DIR__</span> . <span class="variable">$path</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>存根&#x2F;模板文件默认放在根目录的 stubs下面</p></blockquote><h1 id="默认生成文件"><a href="#默认生成文件" class="headerlink" title="默认生成文件"></a>默认生成文件</h1><blockquote><p>文件名 service.stub</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">namespace</span> &#123;&#123; <span class="title class_">namespace</span> &#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">Service</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> </span>&#123;&#123; <span class="class"><span class="keyword">class</span> &#125;&#125; <span class="keyword">extends</span> <span class="title">Service</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="生成附带-use-model-的文件"><a href="#生成附带-use-model-的文件" class="headerlink" title="生成附带 use model 的文件"></a>生成附带 use model 的文件</h1><blockquote><p>文件名 service.plain.stub</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">namespace</span> &#123;&#123; <span class="title class_">namespace</span> &#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">Service</span>;</span><br><span class="line"><span class="keyword">use</span> &#123;&#123; <span class="title">namespacedModel</span> &#125;&#125; <span class="keyword">as</span> <span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> </span>&#123;&#123; <span class="class"><span class="keyword">class</span> &#125;&#125; <span class="keyword">extends</span> <span class="title">Service</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$modelClass</span> = <span class="string">&#x27;&#123;&#123; namespacedModel &#125;&#125;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="生成基类-service-文件"><a href="#生成基类-service-文件" class="headerlink" title="生成基类 service 文件"></a>生成基类 service 文件</h1><blockquote><p>文件名 service.base.stub</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Services</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Builder</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Service</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">#模型</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$modelClass</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:模型类对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Builder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>:AKE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>:2022/7/7 14:34</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">model</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;modelClass)-&gt;<span class="title function_ invoke__">newQuery</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#详情</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detail</span>(<span class="params"><span class="keyword">int</span> <span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;model-&gt;<span class="title function_ invoke__">find</span>(<span class="variable">$id</span>)-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#seo 获取</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seo</span>(<span class="params"><span class="keyword">int</span> <span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;model-&gt;<span class="title function_ invoke__">select</span>([<span class="string">&#x27;seo_title&#x27;</span>, <span class="string">&#x27;seo_keyword&#x27;</span>, <span class="string">&#x27;seo_description&#x27;</span>])-&gt;<span class="title function_ invoke__">find</span>(<span class="variable">$id</span>)-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>#使用命令</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 不添加 model 参数</span><br><span class="line">php artisan make:service IndexService</span><br><span class="line">// 生成use model 的文件</span><br><span class="line">php artisan make:service IndexService -m</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;创建Service命令&lt;/p&gt;</summary>
    
    
    
    <category term="laravel" scheme="https://www.980101.top/categories/laravel/"/>
    
    
    <category term="命令" scheme="https://www.980101.top/tags/%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>laravel中使用jwt</title>
    <link href="https://www.980101.top/2022/07/26/laravel%E4%B8%AD%E4%BD%BF%E7%94%A8jwt/"/>
    <id>https://www.980101.top/2022/07/26/laravel%E4%B8%AD%E4%BD%BF%E7%94%A8jwt/</id>
    <published>2022-07-26T01:35:55.000Z</published>
    <updated>2025-04-19T15:05:01.651Z</updated>
    
    <content type="html"><![CDATA[<p>jwt初使用</p><span id="more"></span><h4 id="安装使用jwt"><a href="#安装使用jwt" class="headerlink" title="安装使用jwt"></a>安装使用jwt</h4><h5 id="1-下载laravel"><a href="#1-下载laravel" class="headerlink" title="1.下载laravel"></a>1.下载laravel</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer create-project --prefer-dist laravel/laravel  jwt  <span class="number">6</span>.* (laravel版本号可写可不写)</span><br></pre></td></tr></table></figure><h5 id="2-安装jwt扩展包"><a href="#2-安装jwt扩展包" class="headerlink" title="2.安装jwt扩展包"></a>2.安装jwt扩展包</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require tymon/jwt-auth:dev-develop --prefer-source</span><br></pre></td></tr></table></figure><h5 id="3-发布资源-这条命令会在config中生成jwt-php配置文件"><a href="#3-发布资源-这条命令会在config中生成jwt-php配置文件" class="headerlink" title="3.发布资源(这条命令会在config中生成jwt.php配置文件)"></a>3.发布资源(这条命令会在config中生成jwt.php配置文件)</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --provider=&quot;Tymon\JWTAuth\Providers\LaravelServiceProvider&quot;</span><br></pre></td></tr></table></figure><h5 id="4-生成jwt秘钥"><a href="#4-生成jwt秘钥" class="headerlink" title="4.生成jwt秘钥"></a>4.生成jwt秘钥</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan jwt:secret</span><br></pre></td></tr></table></figure><h5 id="5-注册中间件"><a href="#5-注册中间件" class="headerlink" title="5.注册中间件"></a>5.注册中间件</h5><p>在app&#x2F;Http&#x2F;Kernel.php文件中 $routeMiddleware中添加如下代码:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;auth.jwt&#x27;</span> =&gt; <span class="title class_">\Tymon\JWTAuth\Http\Middleware\Authenticate</span>::<span class="variable language_">class</span>,</span><br></pre></td></tr></table></figure><p>在需要的路由加上 auth.jwt中间件就可以正常使用</p><h5 id="6-在config-auth-php中"><a href="#6-在config-auth-php中" class="headerlink" title="6.在config&#x2F;auth.php中"></a>6.在config&#x2F;auth.php中</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;guards&#x27;</span> =&gt; [</span><br><span class="line">      <span class="string">&#x27;web&#x27;</span> =&gt; [</span><br><span class="line">          <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;session&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;provider&#x27;</span> =&gt; <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">      ],</span><br><span class="line"></span><br><span class="line">      <span class="string">&#x27;api&#x27;</span> =&gt; [</span><br><span class="line">          <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;jwt&#x27;</span>,<span class="comment">//token修改成jwt</span></span><br><span class="line">          <span class="string">&#x27;provider&#x27;</span> =&gt; <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;hash&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">      ],</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure><p><strong>注:这里可以不修改</strong></p><p>不修改使用方法如下:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">use</span> <span class="title">Tymon</span>\<span class="title">JWTAuth</span>\<span class="title">Facades</span>\<span class="title">JWTAuth</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$input</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">only</span>(<span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;password&#x27;</span>);</span><br><span class="line"><span class="title class_">JWTAuth</span>::<span class="title function_ invoke__">attempt</span>(<span class="variable">$input</span>)<span class="comment">//加密  </span></span><br><span class="line"><span class="title class_">JWTAuth</span>::<span class="title function_ invoke__">invalidate</span>(<span class="variable">$request</span>-&gt;token);<span class="comment">//删除</span></span><br><span class="line"><span class="title class_">JWTAuth</span>::<span class="title function_ invoke__">authenticate</span>(<span class="variable">$request</span>-&gt;token);<span class="comment">//解密获取信息</span></span><br></pre></td></tr></table></figure><p>修改之后使用方法如下(当然修改之后上面的方法还可以继续使用):</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">auth</span>(<span class="string">&#x27;api&#x27;</span>)-&gt;<span class="title function_ invoke__">attempt</span>(<span class="variable">$input</span>);</span><br><span class="line"><span class="title function_ invoke__">auth</span>(<span class="string">&#x27;api&#x27;</span>)-&gt;<span class="title function_ invoke__">invalidate</span>(<span class="variable">$request</span>-&gt;token);</span><br><span class="line"><span class="title function_ invoke__">auth</span>(<span class="string">&#x27;api&#x27;</span>)-&gt;<span class="title function_ invoke__">authenticate</span>(<span class="variable">$request</span>-&gt;token);</span><br></pre></td></tr></table></figure><h4 id="修改jwt默认用户表"><a href="#修改jwt默认用户表" class="headerlink" title="修改jwt默认用户表"></a>修改jwt默认用户表</h4><p>默认使用的是app\User.php(默认链接的是users表),模型内容如下:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">namespace</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">User</span> <span class="keyword">as</span> <span class="title">Authenticatable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Notifications</span>\<span class="title">Notifiable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Tymon</span>\<span class="title">JWTAuth</span>\<span class="title">Contracts</span>\<span class="title">JWTSubject</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Authenticatable</span> <span class="keyword">implements</span> <span class="title">JWTSubject</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Notifiable</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$table</span>  = <span class="string">&#x27;users&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The attributes that are mass assignable.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$fillable</span> = [</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;password&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The attributes that should be hidden for arrays.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$hidden</span> = [</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;remember_token&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The attributes that should be cast to native types.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$casts</span> = [</span><br><span class="line">        <span class="string">&#x27;email_verified_at&#x27;</span> =&gt; <span class="string">&#x27;datetime&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the identifier that will be stored in the subject claim of the JWT.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getJWTIdentifier</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKey</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return a key value array, containing any custom claims to be added to the JWT.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getJWTCustomClaims</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="修改成member表"><a href="#修改成member表" class="headerlink" title="修改成member表"></a>修改成member表</h5><h6 id="1-创建member数据表和对应的模型文件-模型文件代码同上"><a href="#1-创建member数据表和对应的模型文件-模型文件代码同上" class="headerlink" title="1.创建member数据表和对应的模型文件,模型文件代码同上"></a>1.创建member数据表和对应的模型文件,模型文件代码同上</h6><h6 id="2-修改config-auth中代码-如下"><a href="#2-修改config-auth中代码-如下" class="headerlink" title="2.修改config\auth中代码,如下:"></a>2.修改config\auth中代码,如下:</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">&#x27;guards&#x27;</span> =&gt; [</span><br><span class="line">      <span class="string">&#x27;web&#x27;</span> =&gt; [</span><br><span class="line">          <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;session&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;provider&#x27;</span> =&gt; <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">      ],</span><br><span class="line"></span><br><span class="line">      <span class="string">&#x27;api&#x27;</span> =&gt; [</span><br><span class="line">          <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;jwt&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;provider&#x27;</span> =&gt; <span class="string">&#x27;member&#x27;</span>,<span class="comment">//users修改成member</span></span><br><span class="line">          <span class="string">&#x27;hash&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">      ],</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="string">&#x27;providers&#x27;</span> =&gt; [</span><br><span class="line">      <span class="string">&#x27;users&#x27;</span> =&gt; [</span><br><span class="line">          <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;eloquent&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;model&#x27;</span> =&gt; <span class="title class_">App\User</span>::<span class="variable language_">class</span>,</span><br><span class="line">      ],</span><br><span class="line"><span class="comment">//添加member代码</span></span><br><span class="line">      <span class="string">&#x27;member&#x27;</span> =&gt; [</span><br><span class="line">          <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;eloquent&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;model&#x27;</span> =&gt; <span class="title class_">App\Models\Member</span>::<span class="variable language_">class</span>,</span><br><span class="line">      ],</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;jwt初使用&lt;/p&gt;</summary>
    
    
    
    <category term="laravel" scheme="https://www.980101.top/categories/laravel/"/>
    
    
    <category term="框架" scheme="https://www.980101.top/tags/%E6%A1%86%E6%9E%B6/"/>
    
    <category term="jwt" scheme="https://www.980101.top/tags/jwt/"/>
    
  </entry>
  
  <entry>
    <title>laravel第三方包</title>
    <link href="https://www.980101.top/2022/06/24/laravel%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85/"/>
    <id>https://www.980101.top/2022/06/24/laravel%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85/</id>
    <published>2022-06-24T07:51:06.000Z</published>
    <updated>2025-04-19T15:04:25.472Z</updated>
    
    <content type="html"><![CDATA[<p>laravel第三方记录</p><span id="more"></span><p><strong>安装包的时候 后置参数 –dev 表明只在开发环境中使用。</strong></p><h4 id="Debugbar"><a href="#Debugbar" class="headerlink" title="Debugbar"></a>Debugbar</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require &quot;barryvdh/laravel-debugbar:~<span class="number">3</span>.<span class="number">6</span>&quot; --dev</span><br></pre></td></tr></table></figure><h4 id="翻译包"><a href="#翻译包" class="headerlink" title="翻译包"></a>翻译包</h4><blockquote><p>支持了 52 个国家的语言</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require &quot;overtrue/laravel-lang:~<span class="number">6</span>.<span class="number">0</span>&quot;</span><br></pre></td></tr></table></figure><blockquote><p>如果你想修改扩展包提供的语言文件，可以使用以下命令发布语言文件到项目里：</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan lang:publish zh_CN</span><br></pre></td></tr></table></figure><h4 id="图形验证码"><a href="#图形验证码" class="headerlink" title="图形验证码"></a>图形验证码</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require &quot;mews/captcha:~<span class="number">3</span>.<span class="number">0</span>&quot;</span><br></pre></td></tr></table></figure><blockquote><p>生成配置文件</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --provider=&#x27;Mews\Captcha\CaptchaServiceProvider&#x27;</span><br></pre></td></tr></table></figure><blockquote><p>调用</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img <span class="class"><span class="keyword">class</span>=&quot;<span class="title">thumbnail</span> <span class="title">captcha</span> <span class="title">mt</span>-3 <span class="title">mb</span>-2&quot; <span class="title">src</span>=&quot;%7<span class="title">B</span>%7<span class="title">B</span>%20<span class="title">captcha_src</span>(&#x27;<span class="title">flat</span>&#x27;)%20%7<span class="title">D</span>%7<span class="title">D</span>&quot; <span class="title">onclick</span>=&quot;<span class="title">this</span>.<span class="title">src</span>=&#x27;/<span class="title">captcha</span>/<span class="title">flat</span>?&#x27;+<span class="title">Math</span>.<span class="title">random</span>()&quot; <span class="title">title</span>=&quot;点击图片重新获取验证码&quot;&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>验证</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;captcha&#x27;</span> =&gt; [<span class="string">&#x27;required&#x27;</span>, <span class="string">&#x27;captcha&#x27;</span>],</span><br><span class="line"><span class="comment">//required 验证必填</span></span><br><span class="line"><span class="comment">//captcha 验证验证码正确性</span></span><br></pre></td></tr></table></figure><h4 id="图片裁切"><a href="#图片裁切" class="headerlink" title="图片裁切"></a>图片裁切</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require &quot;intervention/image:^<span class="number">2</span>.<span class="number">7</span>&quot;</span><br></pre></td></tr></table></figure><blockquote><p>代码示例</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Intervention</span>\<span class="title">Image</span>\<span class="title">Facades</span>\<span class="title">Image</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">reduceSize</span>(<span class="params"><span class="variable">$file_path</span>, <span class="variable">$max_width</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 先实例化，传参是文件的磁盘物理路径</span></span><br><span class="line">        <span class="variable">$image</span> = <span class="title class_">Image</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$file_path</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 进行大小调整的操作</span></span><br><span class="line">        <span class="variable">$image</span>-&gt;<span class="title function_ invoke__">resize</span>(<span class="variable">$max_width</span>, <span class="literal">null</span>, function (<span class="variable">$constraint</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设定宽度是 $max_width，高度等比例缩放</span></span><br><span class="line">            <span class="variable">$constraint</span>-&gt;<span class="title function_ invoke__">aspectRatio</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 防止裁图时图片尺寸变大</span></span><br><span class="line">            <span class="variable">$constraint</span>-&gt;<span class="title function_ invoke__">upsize</span>();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对图片修改后进行保存</span></span><br><span class="line">        <span class="variable">$image</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require &quot;summerblue/generator:<span class="number">9</span>.*&quot; --dev</span><br></pre></td></tr></table></figure><blockquote><p>示例</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:scaffold Topic --schema=<span class="string">&quot;title:string:index,body:text,user_id:bigInteger:unsigned:index,category_id:integer:unsigned:index,reply_count:integer:unsigned:default(0),view_count:integer:unsigned:default(0),last_reply_user_id:integer:unsigned:default(0),order:integer:unsigned:default(0),excerpt:text:nullable,slug:string:nullable&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>生成的文件作用</p></blockquote><blockquote><p>创建话题的数据库迁移文件 —— 2018_12_23_104258_create_topics_table.php；</p></blockquote><blockquote><p>创建话题数据工厂文件 —— TopicFactory.php；</p></blockquote><blockquote><p>创建话题数据填充文件 —— TopicsTableSeeder.php；</p></blockquote><blockquote><p>创建模型基类文件 —— Model.php， 并创建话题数据模型；</p></blockquote><blockquote><p>创建话题控制器 —— TopicsController.php；</p></blockquote><blockquote><p>创建表单请求的基类文件 —— Request.php，并创建话题表单请求验证类；</p></blockquote><blockquote><p>创建话题模型事件监控器 TopicObserver 并在 AppServiceProvider 中注册；</p></blockquote><blockquote><p>创建授权策略基类文件 —— Policy.php，同时创建话题授权类，并在 AuthServiceProvider 中注册；</p></blockquote><blockquote><p>在 web.php 中更新路由，新增话题相关的资源路由；</p></blockquote><blockquote><p>新建符合资源控制器要求的三个话题视图文件，并存放于 resources&#x2F;views&#x2F;topics 目录中；</p></blockquote><blockquote><p>执行了数据库迁移命令 artisan migrate；</p></blockquote><blockquote><p>因此次操作新建了多个文件，最终执行 composer dump-autoload 来生成 classmap。</p></blockquote><h4 id="laravel-active"><a href="#laravel-active" class="headerlink" title="laravel active"></a>laravel active</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require &quot;summerblue/laravel-active:<span class="number">9</span>.*&quot;</span><br></pre></td></tr></table></figure><blockquote><p>active_class 函数的用法，此函数的定义如下：</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 如果 $condition 不为 False 即会返回字符串 `active`</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>        $condition</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $activeClass</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $inactiveClass</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">active_class</span>(<span class="params"><span class="variable">$condition</span>, <span class="variable">$activeClass</span> = <span class="string">&#x27;active&#x27;</span>, <span class="variable">$inactiveClass</span> = <span class="string">&#x27;&#x27;</span></span>)</span></span><br></pre></td></tr></table></figure><blockquote><p>if_route () - 判断当前对应的路由是否是指定的路由；</p></blockquote><blockquote><p>if_route_param () - 判断当前的 url 有无指定的路由参数。</p></blockquote><blockquote><p>if_query () - 判断指定的 GET 变量是否符合设置的值；</p></blockquote><blockquote><p>if_uri () - 判断当前的 url 是否满足指定的 url；</p></blockquote><blockquote><p>if_route_pattern () - 判断当前的路由是否包含指定的字符；</p></blockquote><blockquote><p>if_uri_pattern () - 判断当前的 url 是否含有指定的字符；</p></blockquote><blockquote><p>示例用法</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">active_class</span>(<span class="title function_ invoke__">if_route</span>(<span class="string">&#x27;topics.index&#x27;</span>))</span><br><span class="line"><span class="title function_ invoke__">active_class</span>((<span class="title function_ invoke__">if_route</span>(<span class="string">&#x27;categories.show&#x27;</span>) &amp;&amp; <span class="title function_ invoke__">if_route_param</span>(<span class="string">&#x27;category&#x27;</span>, <span class="number">4</span>)))</span><br></pre></td></tr></table></figure><h4 id="HTMLPurifier-for-Laravel"><a href="#HTMLPurifier-for-Laravel" class="headerlink" title="HTMLPurifier for Laravel"></a>HTMLPurifier for Laravel</h4><blockquote><p>HTMLPurifier for Laravel 是对 HTMLPurifier 针对 Laravel 框架的一个封装。本章节中，我们将使用此扩展包来对用户内容进行过滤。</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require &quot;mews/purifier:~<span class="number">3</span>.<span class="number">3</span>&quot;</span><br></pre></td></tr></table></figure><blockquote><p>配置 HTMLPurifier for Laravel</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --provider=&quot;Mews\Purifier\PurifierServiceProvider&quot;</span><br></pre></td></tr></table></figure><blockquote><p>config</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">return</span> [</span><br><span class="line">    <span class="string">&#x27;encoding&#x27;</span>         =&gt; <span class="string">&#x27;UTF-8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;finalize&#x27;</span>         =&gt; <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;ignoreNonStrings&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&#x27;cachePath&#x27;</span>        =&gt; <span class="title function_ invoke__">storage_path</span>(<span class="string">&#x27;app/purifier&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;cacheFileMode&#x27;</span>    =&gt; <span class="number">0755</span>,</span><br><span class="line">    <span class="string">&#x27;settings&#x27;</span>         =&gt; [</span><br><span class="line">        <span class="string">&#x27;user_topic_body&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;HTML.Doctype&#x27;</span>             =&gt; <span class="string">&#x27;XHTML 1.0 Transitional&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;HTML.Allowed&#x27;</span>             =&gt; <span class="string">&#x27;div,b,strong,i,em,a[href|title],ul,ol,ol[start],li,p[style],br,span[style],img[width|height|alt|src],*[style|class],pre,hr,code,h2,h3,h4,h5,h6,blockquote,del,table,thead,tbody,tr,th,td&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;CSS.AllowedProperties&#x27;</span>    =&gt; <span class="string">&#x27;font,font-size,font-weight,font-style,margin,width,height,font-family,text-decoration,padding-left,color,background-color,text-align&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;AutoFormat.AutoParagraph&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&#x27;AutoFormat.RemoveEmpty&#x27;</span>   =&gt; <span class="literal">true</span>,</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line">];</span><br></pre></td></tr></table></figure><blockquote><p>示例</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$topic-&gt;body = clean($topic-&gt;body, &#x27;user_topic_body&#x27;);</span><br></pre></td></tr></table></figure><h4 id="中文转拼音"><a href="#中文转拼音" class="headerlink" title="中文转拼音"></a>中文转拼音</h4><blockquote><p>PinYin 是 安正超 开发的</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require &quot;overtrue/pinyin:~<span class="number">4</span>.<span class="number">0</span>&quot;</span><br></pre></td></tr></table></figure><blockquote><p>示例</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Overtrue</span>\<span class="title">Pinyin</span>\<span class="title">Pinyin</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pinyin</span>(<span class="params"><span class="variable">$text</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">app</span>(<span class="title class_">Pinyin</span>::<span class="variable language_">class</span>)-&gt;<span class="title function_ invoke__">permalink</span>(<span class="variable">$text</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="队列监控-Horizon"><a href="#队列监控-Horizon" class="headerlink" title="队列监控 Horizon"></a>队列监控 Horizon</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require &quot;laravel/horizon:~<span class="number">5</span>.<span class="number">6</span>&quot;</span><br></pre></td></tr></table></figure><blockquote><p>配置文件发布</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --provider=&quot;Laravel\Horizon\HorizonServiceProvider&quot;</span><br></pre></td></tr></table></figure><blockquote><p>访问   域名&#x2F;horizon     </p></blockquote><blockquote><p>Horizon 是一个监控程序，需要常驻运行，我们可以通过以下命令启动：</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan horizon</span><br></pre></td></tr></table></figure><blockquote><p>启动 Horizon 之后,就不需要queue:linsten监控了</p></blockquote><h4 id="laravel-permission"><a href="#laravel-permission" class="headerlink" title="laravel-permission"></a>laravel-permission</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require &quot;spatie/laravel-permission:~<span class="number">3</span>.<span class="number">0</span>&quot;</span><br></pre></td></tr></table></figure><blockquote><p>生成数据库迁移文件</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --provider=&quot;Spatie\Permission\PermissionServiceProvider&quot; --tag=&quot;migrations&quot;</span><br></pre></td></tr></table></figure><blockquote><p>生成配置信息</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --provider=&quot;Spatie\Permission\PermissionServiceProvider&quot; --tag=&quot;config&quot;</span><br></pre></td></tr></table></figure><blockquote><p>加载 HasRoles</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">use</span> <span class="title">Spatie</span>\<span class="title">Permission</span>\<span class="title">Traits</span>\<span class="title">HasRoles</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Authenticatable</span> <span class="keyword">implements</span> <span class="title">MustVerifyEmailContract</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">HasRoles</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>用法</p></blockquote><p>新建角色,只需要提供 name 字段即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Spatie</span>\<span class="title">Permission</span>\<span class="title">Models</span>\<span class="title">Role</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$role</span> = <span class="title class_">Role</span>::<span class="title function_ invoke__">create</span>([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Founder&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>为角色添加权限</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Spatie</span>\<span class="title">Permission</span>\<span class="title">Models</span>\<span class="title">Permission</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Permission</span>::<span class="title function_ invoke__">create</span>([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;manage_contents&#x27;</span>]);</span><br><span class="line"><span class="variable">$role</span>-&gt;<span class="title function_ invoke__">givePermissionTo</span>(<span class="string">&#x27;manage_contents&#x27;</span>);</span><br></pre></td></tr></table></figure><p>赋予用户某个角色：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#单个角色</span></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">assignRole</span>(<span class="string">&#x27;Founder&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#多个角色</span></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">assignRole</span>(<span class="string">&#x27;writer&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#数组形式的多个角色</span></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">assignRole</span>([<span class="string">&#x27;writer&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>检查用户角色</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#是否是站长</span></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">hasRole</span>(<span class="string">&#x27;Founder&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#是否拥有至少一个角色</span></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">hasAnyRole</span>(<span class="title class_">Role</span>::<span class="title function_ invoke__">all</span>());  </span><br><span class="line"></span><br><span class="line"><span class="comment">#是否拥有所有角色</span></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">hasAllRoles</span>(<span class="title class_">Role</span>::<span class="title function_ invoke__">all</span>());   </span><br></pre></td></tr></table></figure><p>检查权限：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#检查用户是否有某个权限</span></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">can</span>(<span class="string">&#x27;manage_contents&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">#检查角色是否拥有某个权限</span></span><br><span class="line"><span class="variable">$role</span>-&gt;<span class="title function_ invoke__">hasPermissionTo</span>(<span class="string">&#x27;manage_contents&#x27;</span>);  </span><br></pre></td></tr></table></figure><p>直接给用户添加权限</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#为用户添加『直接权限』</span></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">givePermissionTo</span>(<span class="string">&#x27;manage_contents&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取所有直接权限</span></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">getDirectPermissions</span>() </span><br></pre></td></tr></table></figure><h4 id="用户切换工具"><a href="#用户切换工具" class="headerlink" title="用户切换工具"></a>用户切换工具</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require &quot;viacreative/sudo-su:~<span class="number">1</span>.<span class="number">1</span>&quot;</span><br></pre></td></tr></table></figure><blockquote><p>添加 Provider</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在 app/Providers/AppServiceProvider.php 的 register 方法中添加</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">app</span>()-&gt;<span class="title function_ invoke__">isLocal</span>()) &#123;</span><br><span class="line">  <span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">register</span>(<span class="title class_">\VIACreative\SudoSu\ServiceProvider</span>::<span class="variable language_">class</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>发布资源文件</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --provider=&quot;VIACreative\SudoSu\ServiceProvider&quot;</span><br></pre></td></tr></table></figure><blockquote><p>修改配置信息</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">return</span> [</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 允许使用的顶级域名</span></span><br><span class="line">    <span class="string">&#x27;allowed_tlds&#x27;</span> =&gt; [<span class="string">&#x27;dev&#x27;</span>, <span class="string">&#x27;local&#x27;</span>, <span class="string">&#x27;test&#x27;</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户模型</span></span><br><span class="line">    <span class="string">&#x27;user_model&#x27;</span> =&gt; <span class="title class_">App\Models\User</span>::<span class="variable language_">class</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure><blockquote><p>模板植入</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">if</span>(<span class="title function_ invoke__">app</span>()-&gt;<span class="title function_ invoke__">isLocal</span>())</span><br><span class="line">    @<span class="keyword">include</span>(<span class="string">&quot;sudosu::user-selector&quot;</span>)</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure><p><strong>注: 配置信息中的 allowed_tlds 的值一定要配置,自己域名的顶级域名,即top,com等</strong></p><h4 id="短信发送组件"><a href="#短信发送组件" class="headerlink" title="短信发送组件"></a>短信发送组件</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require &quot;overtrue/easy-sms&quot;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/overtrue/easy-sms">github地址</a></p><p>该组件还没有 Laravel 的 ServiceProvider</p><p>添加配置文件（config&#x2F;easysms.php）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">return</span> [</span><br><span class="line">    <span class="comment">// HTTP 请求的超时时间（秒）</span></span><br><span class="line">    <span class="string">&#x27;timeout&#x27;</span> =&gt; <span class="number">10.0</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 默认发送配置</span></span><br><span class="line">    <span class="string">&#x27;default&#x27;</span> =&gt; [</span><br><span class="line">        <span class="comment">// 网关调用策略，默认：顺序调用</span></span><br><span class="line">        <span class="string">&#x27;strategy&#x27;</span> =&gt; <span class="title class_">\Overtrue\EasySms\Strategies\OrderStrategy</span>::<span class="variable language_">class</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认可用的发送网关</span></span><br><span class="line">        <span class="string">&#x27;gateways&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;aliyun&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 可用的网关配置</span></span><br><span class="line">    <span class="string">&#x27;gateways&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;errorlog&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;file&#x27;</span> =&gt; <span class="string">&#x27;/tmp/easy-sms.log&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;aliyun&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;access_key_id&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;SMS_ALIYUN_ACCESS_KEY_ID&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;access_key_secret&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;SMS_ALIYUN_ACCESS_KEY_SECRET&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;sign_name&#x27;</span> =&gt; <span class="string">&#x27;Larabbs&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;templates&#x27;</span> =&gt; [</span><br><span class="line">          <span class="string">&#x27;register&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;SMS_ALIYUN_TEMPLATE_REGISTER&#x27;</span>),</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>然后创建一个 ServiceProvider</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:provider EasySmsServiceProvider</span><br></pre></td></tr></table></figure><p>写入</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Overtrue</span>\<span class="title">EasySms</span>\<span class="title">EasySms</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EasySmsServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">singleton</span>(<span class="title class_">EasySms</span>::<span class="variable language_">class</span>, function (<span class="variable">$app</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EasySms</span>(<span class="title function_ invoke__">config</span>(<span class="string">&#x27;easysms&#x27;</span>));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">alias</span>(<span class="title class_">EasySms</span>::<span class="variable language_">class</span>, <span class="string">&#x27;easysms&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后打开config&#x2F;app.php<br>在 providers中增加App\Providers\EasySmsServiceProvider::class,</p><p>调用</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sms</span> = <span class="title function_ invoke__">app</span>(<span class="string">&#x27;easysms&#x27;</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$sms</span>-&gt;<span class="title function_ invoke__">send</span>(<span class="number">13212345678</span>, [</span><br><span class="line">         <span class="string">&#x27;template&#x27;</span> =&gt; <span class="string">&#x27;SMS_174806102&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;data&#x27;</span> =&gt; [</span><br><span class="line">             <span class="string">&#x27;code&#x27;</span> =&gt; <span class="number">1234</span></span><br><span class="line">         ],</span><br><span class="line">    ]);</span><br><span class="line">&#125; <span class="keyword">catch</span> (\Overtrue\EasySms\Exceptions\NoGatewayAvailableException <span class="variable">$exception</span>) &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="variable">$exception</span>-&gt;<span class="title function_ invoke__">getException</span>(<span class="string">&#x27;aliyun&#x27;</span>)-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">    <span class="title function_ invoke__">dd</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="通过迁移文件修改字段属性需要doctrine-dbal-组件"><a href="#通过迁移文件修改字段属性需要doctrine-dbal-组件" class="headerlink" title="通过迁移文件修改字段属性需要doctrine&#x2F;dbal 组件"></a>通过迁移文件修改字段属性需要doctrine&#x2F;dbal 组件</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require doctrine/dbal</span><br></pre></td></tr></table></figure><h4 id="Include-机制"><a href="#Include-机制" class="headerlink" title="Include 机制"></a>Include 机制</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require spatie/laravel-query-builder</span><br></pre></td></tr></table></figure><p><a href="https://github.com/spatie/laravel-query-builder">github地址</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Spatie</span>\<span class="title">QueryBuilder</span>\<span class="title">QueryBuilder</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Spatie</span>\<span class="title">QueryBuilder</span>\<span class="title">AllowedFilter</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$topics</span> = <span class="title class_">QueryBuilder</span>::<span class="keyword">for</span>(<span class="title class_">Topic</span>::<span class="variable language_">class</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">allowedIncludes</span>(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;category&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">allowedFilters</span>([</span><br><span class="line">                <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">                <span class="title class_">AllowedFilter</span>::<span class="title function_ invoke__">exact</span>(<span class="string">&#x27;category_id&#x27;</span>),</span><br><span class="line">                <span class="title class_">AllowedFilter</span>::<span class="title function_ invoke__">scope</span>(<span class="string">&#x27;withOrder&#x27;</span>)-&gt;<span class="keyword">default</span>(<span class="string">&#x27;recentReplied&#x27;</span>),</span><br><span class="line">            ])</span><br><span class="line">            -&gt;<span class="title function_ invoke__">paginate</span>();</span><br><span class="line"><span class="comment">//allowedIncludes 是否加载关联关系</span></span><br><span class="line"><span class="comment">//allowedFilters 筛选</span></span><br><span class="line"><span class="comment">//llowedFilter::scope scope方法(scopeWithOrder)</span></span><br></pre></td></tr></table></figure><h4 id="sql日志"><a href="#sql日志" class="headerlink" title="sql日志"></a>sql日志</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require overtrue/laravel-query-logger --dev</span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f ./storage/logs/laravel.log</span><br></pre></td></tr></table></figure><blockquote><p>配置信息(在logging中添加如下内容)</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;query&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;enabled&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;LOG_QUERY&#x27;</span>, <span class="title function_ invoke__">env</span>(<span class="string">&#x27;APP_ENV&#x27;</span>) === <span class="string">&#x27;local&#x27;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Only record queries that are slower than the following time</span></span><br><span class="line">    <span class="comment">// Unit: milliseconds</span></span><br><span class="line">    <span class="string">&#x27;slower_than&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Only record queries when the QUERY_LOG_TRIGGER is set in the environment,</span></span><br><span class="line">    <span class="comment">// or when the trigger HEADER, GET, POST, or COOKIE variable is set.</span></span><br><span class="line">    <span class="string">&#x27;trigger&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;QUERY_LOG_TRIGGER&#x27;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Log Channel 指定通道</span></span><br><span class="line">    <span class="string">&#x27;channel&#x27;</span> =&gt; <span class="string">&#x27;sql&#x27;</span>,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;laravel第三方记录&lt;/p&gt;</summary>
    
    
    
    <category term="laravel" scheme="https://www.980101.top/categories/laravel/"/>
    
    
    <category term="框架" scheme="https://www.980101.top/tags/%E6%A1%86%E6%9E%B6/"/>
    
  </entry>
  
  <entry>
    <title>laravel 生成二维码</title>
    <link href="https://www.980101.top/2022/06/24/laravel-%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81/"/>
    <id>https://www.980101.top/2022/06/24/laravel-%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81/</id>
    <published>2022-06-24T01:48:03.000Z</published>
    <updated>2025-04-19T15:04:00.489Z</updated>
    
    <content type="html"><![CDATA[<p>Bacon&#x2F;BaconQrCode 第三方包</p><span id="more"></span><p><a href="https://github.com/Bacon/BaconQrCode"> Bacon&#x2F;BaconQrCode</a></p><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require simplesoftwareio/simple-qrcode</span><br></pre></td></tr></table></figure><h5 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h5><p>在 <code>config/app.php</code> 注册服务提供者：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SimpleSoftwareIO<span class="title class_">\QrCode\QrCodeServiceProvider</span>::<span class="variable language_">class</span></span><br></pre></td></tr></table></figure><p>同样在 <code>config/app.php</code> 添加 <code>QrCode</code> 门面：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;QrCode&#x27;</span> =&gt; SimpleSoftwareIO<span class="title class_">\QrCode\Facades\QrCode</span>::<span class="variable language_">class</span></span><br></pre></td></tr></table></figure><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><blockquote><p>基本使用</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">SimpleSoftwareIO</span>\<span class="title">QrCode</span>\<span class="title">Facades</span>\<span class="title">QrCode</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">QrCode</span>::<span class="title function_ invoke__">generate</span>(<span class="string">&#x27;Hello,World!&#x27;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>显示中文</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">QrCode</span>::<span class="title function_ invoke__">encoding</span>(<span class="string">&#x27;UTF-8&#x27;</span>)-&gt;<span class="title function_ invoke__">generate</span>(<span class="string">&#x27;你好！&#x27;</span>);</span><br></pre></td></tr></table></figure><blockquote><p><code>generate()</code> 方法还可以接受第二个参数用于指定文件名以及保存路径</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">QrCode</span>::<span class="title function_ invoke__">generate</span>(<span class="string">&#x27;Hello,World!&#x27;</span>, <span class="title function_ invoke__">public_path</span>(<span class="string">&#x27;qrcodes/qrcode.svg&#x27;</span>));</span><br></pre></td></tr></table></figure><blockquote><p>修改保存格式</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//目前 Simple QrCode 支持三种格式：PNG、SVG 和 RPS</span></span><br><span class="line"><span class="comment">//要修改生成二维码图片格式，可以使用 format() 方法</span></span><br><span class="line"><span class="title class_">QrCode</span>::<span class="title function_ invoke__">format</span>(<span class="string">&#x27;png&#x27;</span>)-&gt;<span class="title function_ invoke__">generate</span>(<span class="string">&#x27;Hello,World!&#x27;</span>,<span class="title function_ invoke__">public_path</span>(<span class="string">&#x27;qrcodes/qrcode.png&#x27;</span>));</span><br></pre></td></tr></table></figure><blockquote><p>修改二维码图片尺寸</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//QrCode 生成器默认返回最小尺寸二维码图片。</span></span><br><span class="line"><span class="comment">//如果要修改生成二维码图片尺寸，可以使用 size() 方法</span></span><br><span class="line"><span class="title class_">QrCode</span>::<span class="title function_ invoke__">format</span>(<span class="string">&#x27;png&#x27;</span>)-&gt;<span class="title function_ invoke__">size</span>(<span class="number">100</span>)-&gt;<span class="title function_ invoke__">generate</span>(<span class="string">&#x27;Hello,World!&#x27;</span>,<span class="title function_ invoke__">public_path</span>(<span class="string">&#x27;qrcodes/qrcode.png&#x27;</span>));</span><br><span class="line"><span class="comment">//这样会生成一个宽高均为100像素的二维码图片</span></span><br></pre></td></tr></table></figure><blockquote><p>修改颜色</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以通过 color() 方法来修改生成二维码图片的颜色，颜色参数以 RGB 格式表示</span></span><br><span class="line"><span class="title class_">QrCode</span>::<span class="title function_ invoke__">format</span>(<span class="string">&#x27;png&#x27;</span>)-&gt;<span class="title function_ invoke__">size</span>(<span class="number">100</span>)-&gt;<span class="title function_ invoke__">color</span>(<span class="number">255</span>,<span class="number">0</span>,<span class="number">255</span>)-&gt;<span class="title function_ invoke__">generate</span>(<span class="string">&#x27;Hello,World!&#x27;</span>,<span class="title function_ invoke__">public_path</span>(<span class="string">&#x27;qrcodes/qrcode.png&#x27;</span>));</span><br><span class="line"><span class="comment">//还可以使用 backgroundColor() 方法修改背景色</span></span><br><span class="line"><span class="title class_">QrCode</span>::<span class="title function_ invoke__">format</span>(<span class="string">&#x27;png&#x27;</span>)-&gt;<span class="title function_ invoke__">size</span>(<span class="number">100</span>)-&gt;<span class="title function_ invoke__">color</span>(<span class="number">255</span>,<span class="number">0</span>,<span class="number">255</span>)-&gt;<span class="title function_ invoke__">backgroundColor</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>)-&gt;<span class="title function_ invoke__">generate</span>(<span class="string">&#x27;Hello,World!&#x27;</span>,<span class="title function_ invoke__">public_path</span>(<span class="string">&#x27;qrcodes/qrcode.png&#x27;</span>));</span><br></pre></td></tr></table></figure><blockquote><p>修改边距</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改二维码图片与最外层容器边框的距离，可以使用 margin() 方法</span></span><br><span class="line"><span class="title class_">QrCode</span>::<span class="title function_ invoke__">format</span>(<span class="string">&#x27;png&#x27;</span>)-&gt;<span class="title function_ invoke__">size</span>(<span class="number">100</span>)-&gt;<span class="title function_ invoke__">color</span>(<span class="number">255</span>,<span class="number">0</span>,<span class="number">255</span>)-&gt;<span class="title function_ invoke__">backgroundColor</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>)-&gt;<span class="title function_ invoke__">margin</span>(<span class="number">100</span>)-&gt;<span class="title function_ invoke__">generate</span>(<span class="string">&#x27;Hello,World!&#x27;</span>,<span class="title function_ invoke__">public_path</span>(<span class="string">&#x27;qrcodes/qrcode.png&#x27;</span>));</span><br></pre></td></tr></table></figure><blockquote><p>合并水印图片到二维码</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//需要将 Logo 或者头像放到二维码图片上，这可以通过 merge() 方法实现</span></span><br><span class="line"><span class="title class_">QrCode</span>::<span class="title function_ invoke__">format</span>(<span class="string">&#x27;png&#x27;</span>)-&gt;<span class="title function_ invoke__">size</span>(<span class="number">200</span>)-&gt;<span class="title function_ invoke__">merge</span>(<span class="string">&#x27;/public/qrcodes/laravel.png&#x27;</span>,<span class="number">.15</span>)-&gt;<span class="title function_ invoke__">generate</span>(<span class="string">&#x27;Hello&#x27;</span>,<span class="title function_ invoke__">public_path</span>(<span class="string">&#x27;qrcodes/qrcode.png&#x27;</span>));</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Bacon&amp;#x2F;BaconQrCode 第三方包&lt;/p&gt;</summary>
    
    
    
    <category term="laravel" scheme="https://www.980101.top/categories/laravel/"/>
    
    
    <category term="框架" scheme="https://www.980101.top/tags/%E6%A1%86%E6%9E%B6/"/>
    
  </entry>
  
</feed>
